
> vuesip@1.0.0 test
> vitest


[1m[46m RUN [49m[22m [36mv4.0.8 [39m[90m/home/irony/code/VueSIP[39m

 [32mâœ“[39m tests/performance/metrics/bundle-size.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 110[2mms[22m[39m[35m 61 MB heap used[39m
 [32mâœ“[39m tests/unit/CallSession.test.ts [2m([22m[2m53 tests[22m[2m)[22m[32m 50[2mms[22m[39m[35m 59 MB heap used[39m
 [32mâœ“[39m tests/unit/storage/SessionStorageAdapter.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 35[2mms[22m[39m[35m 59 MB heap used[39m
 [32mâœ“[39m tests/unit/types/index.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 757[2mms[22m[39m[35m 57 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow importing all type definitions [33m 747[2mms[22m[39m[35m 56 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useSipSecondLine.test.ts [2m([22m[2m68 tests[22m[2m)[22m[32m 166[2mms[22m[39m[35m 73 MB heap used[39m
 [32mâœ“[39m tests/unit/providers/OAuth2Provider.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 141[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/test-utilities.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 276[2mms[22m[39m[35m 55 MB heap used[39m
 [32mâœ“[39m tests/integration/conference.test.ts [2m([22m[2m41 tests[22m[2m)[22m[32m 196[2mms[22m[39m[35m 68 MB heap used[39m
 [32mâœ“[39m tests/unit/components/Dialpad.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 227[2mms[22m[39m[35m 66 MB heap used[39m
 [32mâœ“[39m tests/performance/metrics/latency-tracking.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 308[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/providers/SipClientProvider.test.ts [2m([22m[2m25 tests[22m[2m)[22m[33m 341[2mms[22m[39m[35m 61 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useConference.test.ts [2m([22m[2m86 tests[22m[2m)[22m[33m 304[2mms[22m[39m[35m 77 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/AnalyticsPlugin.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 444[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/SipClient.test.ts [2m([22m[2m39 tests[22m[2m)[22m[33m 420[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/unit/core/AudioManager.test.ts [2m([22m[2m58 tests[22m[2m)[22m[33m 490[2mms[22m[39m[35m 61 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/RecordingPlugin.edgecases.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 589[2mms[22m[39m[35m 64 MB heap used[39m
 [31mâ¯[39m tests/unit/providers/MediaProvider.test.ts [2m([22m[2m39 tests[22m[2m | [22m[31m23 failed[39m[2m)[22m[33m 469[2mms[22m[39m[35m 76 MB heap used[39m
[31m       [31mÃ—[31m should render without crashing[39m[32m 40[2mms[22m[39m[33m (retry x2)[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should auto-enumerate devices on mount by default[32m 6[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should skip enumeration when autoEnumerate is false[32m 4[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should request permissions when autoRequestPermissions is true[32m 5[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should emit ready event after enumeration[32m 3[2mms[22m[39m[35m 61 MB heap used[39m
[31m       [31mÃ—[31m should provide device lists to children[39m[32m 12[2mms[22m[39m[33m (retry x2)[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should auto-select default devices when autoSelectDefaults is true[39m[32m 6[2mms[22m[39m[33m (retry x2)[39m[35m 65 MB heap used[39m
[31m       [31mÃ—[31m should not auto-select devices when autoSelectDefaults is false[39m[32m 5[2mms[22m[39m[33m (retry x2)[39m[35m 67 MB heap used[39m
[31m       [31mÃ—[31m should allow enumerating devices via context[39m[32m 3[2mms[22m[39m[33m (retry x2)[39m[35m 68 MB heap used[39m
[31m       [31mÃ—[31m should allow selecting audio input via context[39m[32m 57[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should allow selecting audio output via context[39m[32m 5[2mms[22m[39m[33m (retry x2)[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should allow selecting video input via context[39m[32m 11[2mms[22m[39m[33m (retry x2)[39m[35m 65 MB heap used[39m
[31m       [31mÃ—[31m should allow requesting audio permission via context[39m[32m 7[2mms[22m[39m[33m (retry x2)[39m[35m 66 MB heap used[39m
[31m       [31mÃ—[31m should allow requesting video permission via context[39m[32m 5[2mms[22m[39m[33m (retry x2)[39m[35m 67 MB heap used[39m
[31m       [31mÃ—[31m should allow getting device by ID via context[39m[32m 10[2mms[22m[39m[33m (retry x2)[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should attach device change listener when watchDeviceChanges is true[32m 4[2mms[22m[39m[35m 70 MB heap used[39m
       [32mâœ“[39m should not attach device change listener when watchDeviceChanges is false[32m 2[2mms[22m[39m[35m 70 MB heap used[39m
       [32mâœ“[39m should emit devicesChanged event when devices change[32m 59[2mms[22m[39m[35m 64 MB heap used[39m
[31m       [31mÃ—[31m should remove device change listener on unmount[39m[32m 6[2mms[22m[39m[33m (retry x2)[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should emit permissionsGranted when permissions are granted[32m 3[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should emit permissionsDenied when permissions are denied[32m 4[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should emit error when initialization fails[32m 3[2mms[22m[39m[35m 68 MB heap used[39m
[31m       [31mÃ—[31m should return media context when used within provider[39m[32m 7[2mms[22m[39m[33m (retry x2)[39m[35m 70 MB heap used[39m
       [32mâœ“[39m should throw error when used outside provider[32m 2[2mms[22m[39m[35m 71 MB heap used[39m
[31m       [31mÃ—[31m should expose reactive device lists[39m[32m 10[2mms[22m[39m[33m (retry x2)[39m[35m 74 MB heap used[39m
[31m       [31mÃ—[31m should expose reactive permission status[39m[32m 7[2mms[22m[39m[33m (retry x2)[39m[35m 75 MB heap used[39m
[31m       [31mÃ—[31m should update reactive state when devices change[39m[32m 40[2mms[22m[39m[33m (retry x2)[39m[35m 69 MB heap used[39m
[31m       [31mÃ—[31m should expose testAudioInput method via context[39m[32m 8[2mms[22m[39m[33m (retry x2)[39m[35m 72 MB heap used[39m
[31m       [31mÃ—[31m should expose testAudioOutput method via context[39m[32m 7[2mms[22m[39m[33m (retry x2)[39m[35m 75 MB heap used[39m
[31m       [31mÃ—[31m should allow testing audio input device[39m[32m 8[2mms[22m[39m[33m (retry x2)[39m[35m 77 MB heap used[39m
[31m       [31mÃ—[31m should allow testing audio input device with options[39m[32m 58[2mms[22m[39m[33m (retry x2)[39m[35m 72 MB heap used[39m
[31m       [31mÃ—[31m should allow testing default audio input when no deviceId provided[39m[32m 12[2mms[22m[39m[33m (retry x2)[39m[35m 75 MB heap used[39m
[31m       [31mÃ—[31m should allow testing audio output device[39m[32m 8[2mms[22m[39m[33m (retry x2)[39m[35m 77 MB heap used[39m
[31m       [31mÃ—[31m should allow testing default audio output when no deviceId provided[39m[32m 15[2mms[22m[39m[33m (retry x2)[39m[35m 80 MB heap used[39m
       [32mâœ“[39m should handle no available devices gracefully[32m 7[2mms[22m[39m[35m 72 MB heap used[39m
       [32mâœ“[39m should handle enumeration errors gracefully[32m 5[2mms[22m[39m[35m 73 MB heap used[39m
       [32mâœ“[39m should handle permission request errors gracefully[32m 4[2mms[22m[39m[35m 73 MB heap used[39m
       [32mâœ“[39m should handle device change errors gracefully[32m 4[2mms[22m[39m[35m 74 MB heap used[39m
       [32mâœ“[39m should handle non-Error objects in error handling[32m 3[2mms[22m[39m[35m 76 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useSipRegistration.test.ts [2m([22m[2m49 tests[22m[2m)[22m[32m 134[2mms[22m[39m[35m 54 MB heap used[39m
 [32mâœ“[39m tests/unit/AmiClient.test.ts [2m([22m[2m67 tests[22m[2m)[22m[33m 756[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useMediaDevices.test.ts [2m([22m[2m68 tests[22m[2m)[22m[33m 800[2mms[22m[39m[35m 65 MB heap used[39m
       [33m[2mâœ“[22m[39m should test audio output device [33m 504[2mms[22m[39m[35m 65 MB heap used[39m
 [32mâœ“[39m tests/performance/load-tests/concurrent-calls.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 905[2mms[22m[39m[35m 69 MB heap used[39m
       [33m[2mâœ“[22m[39m should detect performance degradation with increasing concurrent calls [33m 308[2mms[22m[39m[35m 69 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/AnalyticsPlugin.edgecases.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 1534[2mms[22m[39m[35m 63 MB heap used[39m
[90mstderr[2m | tests/unit/stores/persistence.test.ts[2m > [22m[2mStorePersistenceManager[2m > [22m[2minitialization[2m > [22m[2mshould handle localStorage initialization errors gracefully
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstderr[2m | tests/unit/stores/persistence.test.ts[2m > [22m[2mStorePersistenceManager[2m > [22m[2minitialization[2m > [22m[2mshould handle IndexedDB initialization errors gracefully
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

 [32mâœ“[39m tests/performance/load-tests/rapid-operations.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1333[2mms[22m[39m[35m 90 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle 100+ rapid call creation/termination cycles without crashes [33m 976[2mms[22m[39m[35m 73 MB heap used[39m
[90mstderr[2m | tests/unit/stores/persistence.test.ts[2m > [22m[2mStorePersistenceManager[2m > [22m[2merror handling[2m > [22m[2mshould continue initialization despite store setup errors
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

 [32mâœ“[39m tests/unit/composables/useCallControls.test.ts [2m([22m[2m57 tests[22m[2m)[22m[32m 135[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/stores/persistence.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 151[2mms[22m[39m[35m 45 MB heap used[39m
 [32mâœ“[39m tests/performance/load-tests/large-call-history.test.ts [2m([22m[2m41 tests[22m[2m)[22m[32m 121[2mms[22m[39m[35m 73 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useDialog.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 41[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/abortController.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 44[2mms[22m[39m[35m 57 MB heap used[39m
 [32mâœ“[39m tests/unit/SipClient.presence.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 161[2mms[22m[39m[35m 60 MB heap used[39m
 [32mâœ“[39m tests/unit/EventBus.test.ts [2m([22m[2m26 tests[22m[2m)[22m[32m 63[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/storage/IndexedDBAdapter.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 130[2mms[22m[39m[35m 67 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiDatabase.test.ts [2m([22m[2m42 tests[22m[2m)[22m[32m 69[2mms[22m[39m[35m 60 MB heap used[39m
 [32mâœ“[39m tests/unit/components/ReturnTimeDisplay.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 200[2mms[22m[39m[35m 67 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiTimeConditions.test.ts [2m([22m[2m56 tests[22m[2m)[22m[32m 151[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useSipE911.test.ts [2m([22m[2m46 tests[22m[2m)[22m[32m 88[2mms[22m[39m[35m 67 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useMessaging.test.ts [2m([22m[2m66 tests[22m[2m)[22m[32m 220[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiAgentLogin.test.ts [2m([22m[2m67 tests[22m[2m)[22m[32m 228[2mms[22m[39m[35m 66 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useDTMF.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 2101[2mms[22m[39m[35m 62 MB heap used[39m
       [33m[2mâœ“[22m[39m should process queue without exceeding limit [33m 641[2mms[22m[39m[35m 58 MB heap used[39m
 [32mâœ“[39m tests/unit/providers/ConfigProvider.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 201[2mms[22m[39m[35m 69 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiRecording.test.ts [2m([22m[2m56 tests[22m[2m)[22m[32m 98[2mms[22m[39m[35m 61 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/RecordingPlugin.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 176[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useCallSession.test.ts [2m([22m[2m79 tests[22m[2m)[22m[33m 556[2mms[22m[39m[35m 72 MB heap used[39m
 [32mâœ“[39m tests/unit/components/CallControls.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 92[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiRingGroups.test.ts [2m([22m[2m49 tests[22m[2m)[22m[32m 125[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/performance/load-tests/event-listeners.test.ts [2m([22m[2m22 tests[22m[2m)[22m[32m 119[2mms[22m[39m[35m 67 MB heap used[39m
 [32mâœ“[39m tests/integration/network-resilience.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 92[2mms[22m[39m[35m 61 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/encryption.test.ts [2m([22m[2m34 tests[22m[2m)[22m[32m 204[2mms[22m[39m[35m 59 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiPaging.test.ts [2m([22m[2m48 tests[22m[2m)[22m[32m 177[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/integration/sip-workflow.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 133[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m src/composables/__tests__/useTheme.test.ts [2m([22m[2m12 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[32m 60[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/integration/agent-network-conditions.test.ts [2m([22m[2m25 tests[22m[2m)[22m[33m 3037[2mms[22m[39m[35m 65 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle call between agents with different network profiles [33m 403[2mms[22m[39m[35m 62 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle messaging between agents with high latency [33m 1401[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useSipDtmf.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 63[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/encryption.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 160[2mms[22m[39m[35m 58 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/EventEmitter.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 120[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/usePresence.test.ts [2m([22m[2m64 tests[22m[2m)[22m[32m 140[2mms[22m[39m[35m 64 MB heap used[39m
[90mstderr[2m | tests/unit/plugins/AnalyticsPlugin.validation.test.ts[2m > [22m[2mAnalyticsPlugin - Validation[2m > [22m[2mLarge Event Payload Size Limits[2m > [22m[2mshould handle serialization failures
[22m[39m01:01:22.561 WARN [AnalyticsPlugin] Event payload too large for type "test:event", skipping

 [32mâœ“[39m tests/unit/plugins/AnalyticsPlugin.validation.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 206[2mms[22m[39m[35m 70 MB heap used[39m
 [32mâœ“[39m tests/unit/services/OAuth2Service.test.ts [2m([22m[2m47 tests[22m[2m)[22m[32m 95[2mms[22m[39m[35m 65 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiCDR.test.ts [2m([22m[2m52 tests[22m[2m)[22m[32m 154[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useSipClient.test.ts [2m([22m[2m48 tests[22m[2m)[22m[33m 3577[2mms[22m[39m[35m 75 MB heap used[39m
       [33m[2mâœ“[22m[39m should reconnect successfully [33m 1007[2mms[22m[39m[35m 76 MB heap used[39m
       [33m[2mâœ“[22m[39m should reconnect when not previously connected [33m 1007[2mms[22m[39m[35m 69 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle reconnection failure [33m 1030[2mms[22m[39m[35m 71 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiAgentStats.test.ts [2m([22m[2m49 tests[22m[2m)[22m[32m 104[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/storage/persistence.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 28[2mms[22m[39m[35m 57 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiIVR.test.ts [2m([22m[2m46 tests[22m[2m)[22m[32m 111[2mms[22m[39m[35m 61 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useSipAutoAnswer.test.ts [2m([22m[2m62 tests[22m[2m)[22m[32m 70[2mms[22m[39m[35m 65 MB heap used[39m
 [32mâœ“[39m tests/unit/stores/registrationStore.test.ts [2m([22m[2m35 tests[22m[2m)[22m[32m 39[2mms[22m[39m[35m 60 MB heap used[39m
 [31mâ¯[39m tests/unit/SipClient.error-recovery.test.ts [2m([22m[2m35 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[32m 131[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should handle connection failure[32m 14[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should handle WebSocket connection timeout[32m 3[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should handle connection lost during active session[32m 2[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should emit disconnected event with error details[32m 2[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should handle multiple disconnect events gracefully[32m 2[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should prevent multiple simultaneous starts[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should warn when starting already started client[32m 2[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should handle stop while starting[32m 2[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should prevent multiple simultaneous stops[32m 3[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should handle stop when not started[32m 0[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should reject invalid configuration on start[32m 2[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should validate URI format[32m 0[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should validate SIP URI format[32m 10[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should accept valid configuration[32m 0[2mms[22m[39m[35m 59 MB heap used[39m
[31m       [31mÃ—[31m should handle event with missing data gracefully[39m[32m 19[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
[31m       [31mÃ—[31m should handle malformed event data[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should handle event during shutdown[39m[32m 6[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should maintain state consistency during connection[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should maintain state consistency during disconnection[32m 2[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should track isConnected property accurately[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should track isRegistered property accurately[39m[32m 45[2mms[22m[39m[33m (retry x2)[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should return readonly copy of state[32m 0[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should return readonly copy of config[32m 0[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should expose eventBus getter[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should clean up event handlers on stop[32m 2[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should handle rapid start/stop cycles[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should clean up UA on stop[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should extract username from SIP URI[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should use configured WebSocket URI[32m 2[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should support custom user agent string[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should use default user agent if not specified[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should create client via factory function[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should transition through connection states correctly[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should propagate UA errors to event bus[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should handle registration expiring events[32m 2[2mms[22m[39m[35m 65 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiBlacklist.test.ts [2m([22m[2m56 tests[22m[2m)[22m[32m 141[2mms[22m[39m[35m 67 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiFeatureCodes.test.ts [2m([22m[2m41 tests[22m[2m)[22m[32m 126[2mms[22m[39m[35m 68 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiCallback.test.ts [2m([22m[2m46 tests[22m[2m)[22m[32m 103[2mms[22m[39m[35m 68 MB heap used[39m
 [32mâœ“[39m tests/unit/services/AmiService.test.ts [2m([22m[2m50 tests[22m[2m)[22m[32m 95[2mms[22m[39m[35m 69 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiQueues.test.ts [2m([22m[2m39 tests[22m[2m)[22m[32m 90[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useSipWebRTCStats.test.ts [2m([22m[2m45 tests[22m[2m)[22m[32m 114[2mms[22m[39m[35m 60 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiSupervisor.test.ts [2m([22m[2m32 tests[22m[2m)[22m[32m 55[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/HookManager.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 40[2mms[22m[39m[35m 68 MB heap used[39m
 [31mâ¯[39m tests/unit/core/FreePBXPresenceBridge.test.ts [2m([22m[2m52 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 81[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should create bridge with default config values[32m 6[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should merge provided config with defaults[32m 2[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should set user agent successfully[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should unsubscribe all when UA is set to null[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should parse basic PIDF document with open status[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should parse PIDF document with closed status[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should parse PIDF with status note/message[32m 2[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should parse PIDF with device state hint[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should parse PIDF with display name[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should handle malformed PIDF gracefully[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should parse absolute time "2:30 PM"[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
[31m       [31mÃ—[31m should parse 24-hour time "14:30"[39m[32m 15[2mms[22m[39m[33m (retry x2)[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should parse relative duration "30 minutes"[32m 1[2mms[22m[39m[35m 59 MB heap used[39m
[31m       [31mÃ—[31m should parse relative duration "1 hour"[39m[32m 2[2mms[22m[39m[33m (retry x2)[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should parse shorthand "~15m"[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should parse shorthand "~2h"[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should handle time earlier than now (assume tomorrow)[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
[31m       [31mÃ—[31m should detect overdue return times[39m[32m 17[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should detect lunch reason[32m 1[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should detect break reason[32m 1[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should detect meeting reason[32m 0[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should detect rounds reason[32m 1[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should detect patient care reason[32m 0[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should detect procedure reason[32m 1[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should detect vacation reason[32m 0[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should detect out of office reason[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should default to Away for unknown reasons[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should start REST API polling when useRestApi is true[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should poll presence status at specified interval[32m 2[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should handle API errors gracefully[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should map REST status codes correctly[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should get presence status for extension[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should get all presence statuses[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should get default presence status[32m 0[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should set return time with Date object[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should set return time with duration in minutes[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should clear return time[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should handle setting return time for non-existent extension[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should handle clearing return time for non-existent extension[32m 0[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should call onPresenceUpdate when presence changes[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should call onReturnTimeUpdate when return time countdown updates[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should emit return_time_expired event when overdue[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should handle errors in callback gracefully[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should unsubscribe from specific extension[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should unsubscribe from all extensions[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should cleanup all resources on destroy[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should stop polling timer on destroy[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should clear all callbacks on destroy[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should use custom parser when provided[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should fallback to REST API when SIP SUBSCRIBE not supported[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should warn when no UA available for SIP subscription[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should warn when fetching all extensions without API token[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiVoicemail.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 75[2mms[22m[39m[35m 59 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useCallTransfer.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 72[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/storageQuota.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 48[2mms[22m[39m[35m 55 MB heap used[39m
 [32mâœ“[39m tests/unit/core/CallSession.transfer.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 55[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/dialogInfoParser.test.ts [2m([22m[2m37 tests[22m[2m)[22m[32m 111[2mms[22m[39m[35m 58 MB heap used[39m
[90mstderr[2m | tests/unit/MediaManager.test.ts[2m > [22m[2mMediaManager[2m > [22m[2mtestDevice[2m > [22m[2mshould handle audio level measurement failure gracefully
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

 [32mâœ“[39m tests/unit/composables/useAmiCalls.test.ts [2m([22m[2m32 tests[22m[2m)[22m[32m 91[2mms[22m[39m[35m 58 MB heap used[39m
 [32mâœ“[39m tests/unit/SipClient.config-utilities.test.ts [2m([22m[2m44 tests[22m[2m)[22m[32m 93[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/integration/device-switching.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 66[2mms[22m[39m[35m 68 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useCallHistory.test.ts [2m([22m[2m57 tests[22m[2m)[22m[32m 109[2mms[22m[39m[35m 57 MB heap used[39m
 [31mâ¯[39m tests/unit/core/MultiLineManager.test.ts [2m([22m[2m78 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 154[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should initialize with default config[32m 3[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should initialize with custom config[32m 2[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should initialize all lines to IDLE state[32m 2[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should use provided event bus[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should get specific line by ID[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should return undefined for non-existent line[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should get all lines[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should get active line[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should get active line ID[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should find available idle line[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should prefer specific line when available[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should exclude specified lines[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should allow held lines when specified[32m 2[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should not return held lines when allowHeld is false[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should return undefined when no lines match criteria[32m 0[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should assign call to specific line[32m 0[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should auto-assign call to first available line[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should emit LINE_ASSIGNED event[32m 2[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should throw error for invalid line ID[32m 2[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should throw error when line is busy[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should throw error when no available lines[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should extract remote party from remoteUri string[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should extract remote party from remoteUri object[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should fallback to remoteDisplayName for remote party[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should use "Unknown" as fallback remote party[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should increment call counter[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should switch to different line[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should emit LINE_SWITCHED event[32m 2[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should hold active line when switching away[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should resume held line when switching to it[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should throw error for non-existent line[32m 4[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should not hold line when switching to same line[32m 3[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should hold active line[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should resume held line[32m 72[2mms[22m[39m[35m 56 MB heap used[39m
       [32mâœ“[39m should throw error when holding non-active line[32m 1[2mms[22m[39m[35m 56 MB heap used[39m
       [32mâœ“[39m should throw error when resuming non-held line[32m 1[2mms[22m[39m[35m 56 MB heap used[39m
       [32mâœ“[39m should throw error when line not found[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should throw error when no call session on line[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should handle missing hold method on call session[32m 0[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should park a call[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should emit CALL_PARKED event[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should retrieve parked call[32m 1[2mms[22m[39m[35m 57 MB heap used[39m
       [32mâœ“[39m should emit CALL_RETRIEVED event[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should throw error when parking is disabled[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should throw error when no active call on line[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should throw error when retrieving non-existent park slot[32m 0[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should list all parked calls[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should create conference with multiple lines[32m 1[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should emit CONFERENCE_CREATED event[32m 1[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should throw error when conference is disabled[32m 0[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should throw error when less than 2 lines provided[32m 0[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should throw error when line not found or no call[32m 0[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should add line to existing conference[32m 1[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should add to first active conference if ID not provided[32m 1[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should not add line already in conference[32m 0[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should remove line from conference[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should end conference when only one participant remains[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should get conference state[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
[31m       [31mÃ—[31m should get all active conferences[39m[32m 15[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should release call from line[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should emit LINE_RELEASED event[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should remove from conference when releasing[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should remove from park slots when releasing[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should handle releasing non-existent line gracefully[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should alias releaseLine to releaseCall[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should update line state and emit event[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should set start time when call becomes active[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should clear start time when call ends[32m 0[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should get line statistics[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should track active lines in stats[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should track held lines in stats[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should update call durations[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should not update duration for non-active lines[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should reset all lines to idle[32m 1[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should end all conferences on reset[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should clear all park slots on reset[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should reset active line to default[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should reset call counter[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
 [31mâ¯[39m tests/unit/MediaManager.test.ts [2m([22m[2m109 tests[22m[2m | [22m[31m27 failed[39m[2m)[22m[33m 5385[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should initialize with default configuration[32m 5[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should accept custom RTC configuration[32m 0[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should accept media configuration[32m 0[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should enable auto quality adjustment if specified[32m 0[2mms[22m[39m[35m 58 MB heap used[39m
[31m       [31mÃ—[31m should create peer connection[39m[32m 20[2mms[22m[39m[33m (retry x2)[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should get existing peer connection[32m 0[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should close existing peer connection when creating new one[32m 2[2mms[22m[39m[35m 60 MB heap used[39m
[31m       [31mÃ—[31m should close peer connection[39m[32m 2[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
[31m       [31mÃ—[31m should setup peer connection event handlers[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
[31m       [31mÃ—[31m should emit ICE candidate event[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should emit ICE gathering complete event on null candidate[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should emit ICE connection state change event[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should handle connection failure[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should emit track added event[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should create offer[32m 0[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should create answer[32m 0[2mms[22m[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should set local description[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 64 MB heap used[39m
[31m       [31mÃ—[31m should set remote description[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should add ICE candidate[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [33m[2mâœ“[22m[39m should wait for ICE gathering [33m 5002[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should timeout ICE gathering if it takes too long[32m 4[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should get user media[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should cleanup previous stream when getting new media[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should update permissions on getUserMedia success[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should update permissions on getUserMedia failure[32m 2[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should handle video permission denial in getUserMedia[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should prevent concurrent getUserMedia calls[32m 101[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should add local stream to peer connection[32m 2[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should add local stream with multiple tracks[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should setup DTMF sender for audio tracks[32m 0[2mms[22m[39m[35m 65 MB heap used[39m
[31m       [31mÃ—[31m should remove local stream from peer connection[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should stop local stream[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should handle stopLocalStream when no stream exists[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should get local stream[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should get remote stream[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should send DTMF tone[32m 4[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should send DTMF tone with duration and gap[32m 1[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should throw error if DTMF sender not available[32m 1[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should handle DTMF insertion failure[32m 1[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should check if DTMF is available[32m 1[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should enumerate devices[32m 1[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should handle enumerateDevices failure[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should return cached devices when cache is valid[32m 1[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should force refresh devices when requested[32m 1[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should get audio input devices[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should get audio output devices[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should get video input devices[32m 1[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should select audio input device[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should return undefined when no audio input selected[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should select audio output device[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should select video input device[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should request permissions[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should request video permissions[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should handle permission denial[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should handle video permission denial[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should get current permissions[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should return a copy of permissions object[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should start device change monitoring[32m 2[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should stop device change monitoring[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should test audio input device[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should handle audio input test failure[32m 1[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should test video input device[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should handle video input test failure[32m 20[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should get statistics[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should include audio statistics[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should calculate packet loss percentage[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should include network statistics[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
[31m       [31mÃ—[31m should include ICE candidate type statistics[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
[31m       [31mÃ—[31m should include transport statistics[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
[31m       [31mÃ—[31m should include outbound video statistics[39m[32m 2[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should throw error if peer connection not available[32m 0[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should destroy media manager[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should close peer connection on destroy[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should manually set device list[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should emit device change event when setting devices[32m 11[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should use default label for unlabeled devices[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should mark default devices[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should return failure for unknown device[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should test audio input device with level measurement[32m 2[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should handle audio level measurement failure gracefully[32m 3[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should test video input device[32m 2[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should return success for audio output (not testable)[32m 3[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should handle getUserMedia failure during audio test[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
       [32mâœ“[39m should adjust quality based on network conditions[32m 1[2mms[22m[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should warn on high audio packet loss[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 64 MB heap used[39m
[31m       [31mÃ—[31m should warn on high video packet loss[39m[32m 3[2mms[22m[39m[33m (retry x2)[39m[35m 64 MB heap used[39m
[31m       [31mÃ—[31m should warn on high round trip time[39m[32m 4[2mms[22m[39m[33m (retry x2)[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should not start quality adjustment twice[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
[31m       [31mÃ—[31m should stop quality adjustment on destroy[39m[32m 2[2mms[22m[39m[33m (retry x2)[39m[35m 65 MB heap used[39m
[31m       [31mÃ—[31m should handle adjustQuality errors in interval callback[39m[32m 2[2mms[22m[39m[33m (retry x2)[39m[35m 66 MB heap used[39m
[31m       [31mÃ—[31m should execute adjustQuality when interval fires[39m[32m 6[2mms[22m[39m[33m (retry x2)[39m[35m 66 MB heap used[39m
[31m       [31mÃ—[31m should skip adjustQuality when peer connection is null[39m[32m 2[2mms[22m[39m[33m (retry x2)[39m[35m 67 MB heap used[39m
[31m       [31mÃ—[31m should not start quality adjustment interval twice[39m[32m 3[2mms[22m[39m[33m (retry x2)[39m[35m 67 MB heap used[39m
[31m       [31mÃ—[31m should detect high video packet loss in adjustQuality[39m[32m 4[2mms[22m[39m[33m (retry x2)[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should apply exact video device ID constraint when video is true[32m 2[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should apply exact video device ID constraint when video is object[32m 1[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should override echoCancellation constraint[32m 8[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should override noiseSuppression constraint[32m 1[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should override autoGainControl constraint[32m 1[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should combine audio constraints with device selection[32m 1[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should handle device with unknown kind[32m 0[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should not start device change monitoring twice[32m 0[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should emit device change event using emitSync[32m 51[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should detect added and removed devices[32m 51[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should not start stats collection twice[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should stop stats collection on destroy[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should include TURN servers with credentialType[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should handle TURN servers without credentialType[39m[32m 0[2mms[22m[39m[33m (retry x2)[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should handle multiple TURN servers[39m[32m 0[2mms[22m[39m[33m (retry x2)[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/unit/formatters.test.ts [2m([22m[2m74 tests[22m[2m)[22m[32m 92[2mms[22m[39m[35m 55 MB heap used[39m
[90mstderr[2m | tests/performance/load-tests/memory-leaks.test.ts[2m > [22m[2mMemory Leak Detection Tests[2m > [22m[2mGarbage Collection Verification[2m > [22m[2mshould verify that global.gc is available for accurate testing
[22m[39m
âš ï¸  WARNING: global.gc is not available. Run tests with --expose-gc flag for accurate memory leak detection.
   Example: vitest run --expose-gc tests/performance/load-tests/memory-leaks.test.ts


[90mstderr[2m | tests/unit/composables/useAudioDevices.test.ts[2m > [22m[2museAudioDevices[2m > [22m[2mDevice Enumeration[2m > [22m[2mshould handle enumeration errors
[22m[39mFailed to enumerate devices: Error: Enumeration failed
    at [90m/home/irony/code/VueSIP/[39mtests/unit/composables/useAudioDevices.test.ts:182:44
    at [90mfile:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:157:11
    at [90mfile:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:753:26
    at [90mfile:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1636:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1602:10[90m)[39m
    at runTest [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1309:12[90m)[39m
    at runSuite [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1468:8[90m)[39m
    at runSuite [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1468:8[90m)[39m
    at runSuite [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1468:8[90m)[39m

 [32mâœ“[39m tests/unit/stores/configStore.test.ts [2m([22m[2m50 tests[22m[2m)[22m[32m 33[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/performance/load-tests/memory-leaks.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 5604[2mms[22m[39m[35m 91 MB heap used[39m
       [33m[2mâœ“[22m[39m should not leak memory after 100 call creation/termination cycles [33m 1137[2mms[22m[39m[35m 69 MB heap used[39m
       [33m[2mâœ“[22m[39m should not leak memory after acquiring and releasing media streams 100 times [33m 676[2mms[22m[39m[35m 79 MB heap used[39m
       [33m[2mâœ“[22m[39m should not leak memory in 100 full call cycles with media [33m 1686[2mms[22m[39m[35m 83 MB heap used[39m
       [33m[2mâœ“[22m[39m should maintain stable memory during a long-running call session [33m 1069[2mms[22m[39m[35m 87 MB heap used[39m
[90mstderr[2m | tests/unit/composables/useAudioDevices.test.ts[2m > [22m[2museAudioDevices[2m > [22m[2mReactive State[2m > [22m[2mshould have reactive error state
[22m[39mFailed to enumerate devices: Error: Test error
    at [90m/home/irony/code/VueSIP/[39mtests/unit/composables/useAudioDevices.test.ts:633:44
    at [90mfile:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:157:11
    at [90mfile:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:753:26
    at [90mfile:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1636:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1602:10[90m)[39m
    at runTest [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1309:12[90m)[39m
    at runSuite [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1468:8[90m)[39m
    at runSuite [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1468:8[90m)[39m
    at runSuite [90m(file:///home/irony/code/VueSIP/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.8/node_modules/[4m@vitest[24m/runner/dist/index.js:1468:8[90m)[39m

 [32mâœ“[39m tests/unit/composables/useAudioDevices.test.ts [2m([22m[2m52 tests[22m[2m)[22m[32m 119[2mms[22m[39m[35m 69 MB heap used[39m
 [32mâœ“[39m tests/unit/TransportManager.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 107[2mms[22m[39m[35m 57 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiPeers.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 117[2mms[22m[39m[35m 57 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmiParking.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 119[2mms[22m[39m[35m 60 MB heap used[39m
 [31mâ¯[39m tests/unit/SipClient.registration.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 91[2mms[22m[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should register successfully[39m[32m 28[2mms[22m[39m[33m (retry x2)[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should handle registration failure[32m 2[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should handle registration timeout[32m 14[2mms[22m[39m[35m 58 MB heap used[39m
       [32mâœ“[39m should skip registration if already registered[32m 2[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should throw error if registering without connection[32m 0[2mms[22m[39m[35m 59 MB heap used[39m
[31m       [31mÃ—[31m should unregister successfully[39m[32m 25[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should handle unregistration timeout[32m 3[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should skip unregister if not registered[32m 2[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should throw error if unregistering without UA[32m 2[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should auto-register when configured[32m 4[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should not auto-register when disabled[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should track registration expiring[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should emit registration events[32m 4[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should handle password authentication[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should handle authorization username[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should handle realm configuration[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should handle HA1 authentication[32m 0[2mms[22m[39m[35m 62 MB heap used[39m
 [31mâ¯[39m tests/unit/SipClient.calls.test.ts [2m([22m[2m36 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 81[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should make basic outgoing call[32m 9[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should make call with audio only[32m 1[2mms[22m[39m[35m 61 MB heap used[39m
       [32mâœ“[39m should make call with audio and video[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should make call with extra headers[32m 1[2mms[22m[39m[35m 62 MB heap used[39m
[31m       [31mÃ—[31m should make call with custom SDP[39m[32m 18[2mms[22m[39m[33m (retry x2)[39m[35m 63 MB heap used[39m
[31m       [31mÃ—[31m should handle call with RTCPeerConnection configuration[39m[32m 10[2mms[22m[39m[33m (retry x2)[39m[35m 64 MB heap used[39m
       [32mâœ“[39m should generate unique call ID for each call[32m 1[2mms[22m[39m[35m 64 MB heap used[39m
[31m       [31mÃ—[31m should use makeCall for backward compatibility[39m[32m 4[2mms[22m[39m[33m (retry x2)[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should handle incoming call[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should not emit event for outgoing call[32m 1[2mms[22m[39m[35m 65 MB heap used[39m
       [32mâœ“[39m should extract caller information from incoming call[32m 1[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should handle call progress event[32m 1[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should handle call accepted event[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should handle call confirmed/established event[32m 1[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should handle call ended event[32m 5[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should handle call failed event[32m 0[2mms[22m[39m[35m 66 MB heap used[39m
       [32mâœ“[39m should handle hold event[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should handle unhold event[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should handle mute/unmute events[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should answer incoming call[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should hangup active call[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should hold call[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should unhold call[32m 0[2mms[22m[39m[35m 67 MB heap used[39m
       [32mâœ“[39m should transfer call[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should mute call[32m 1[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should unmute call[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should send DTMF tones[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should track active calls[32m 1[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should remove call from active list when ended[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should get call by ID[32m 0[2mms[22m[39m[35m 68 MB heap used[39m
       [32mâœ“[39m should access remote media streams[32m 1[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should access local media streams[32m 0[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should handle video track addition[32m 0[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should handle video track removal[32m 0[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should track call duration[32m 0[2mms[22m[39m[35m 69 MB heap used[39m
       [32mâœ“[39m should track call end reason[32m 0[2mms[22m[39m[35m 69 MB heap used[39m
 [32mâœ“[39m tests/unit/stores/callStore.test.ts [2m([22m[2m37 tests[22m[2m)[22m[32m 49[2mms[22m[39m[35m 64 MB heap used[39m
 [31mâ¯[39m tests/unit/SipClient.e2e-mode.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m2 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 42[2mms[22m[39m[35m 62 MB heap used[39m
       [32mâœ“[39m should detect E2E test mode with __emitSipEvent[32m 13[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should detect E2E test mode with __sipEventBridge[32m 1[2mms[22m[39m[35m 59 MB heap used[39m
       [2m[90mâ†“[39m[22m should use normal mode when E2E globals not present
       [32mâœ“[39m should immediately transition to connected state in E2E mode[32m 1[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should emit connection events to EventBridge[32m 0[2mms[22m[39m[35m 59 MB heap used[39m
       [32mâœ“[39m should setup EventBridge listeners for incoming calls[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should auto-register in E2E mode when enabled[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should skip auto-register in E2E mode when disabled[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should handle simulated incoming calls in E2E mode[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should filter E2E incoming calls by direction[32m 9[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should log E2E detection details[32m 1[2mms[22m[39m[35m 60 MB heap used[39m
       [32mâœ“[39m should log successful E2E start[32m 0[2mms[22m[39m[35m 60 MB heap used[39m
[31m       [31mÃ—[31m should maintain consistent state in E2E mode[39m[32m 6[2mms[22m[39m[33m (retry x2)[39m[35m 61 MB heap used[39m
[31m       [31mÃ—[31m should allow stop in E2E mode[39m[32m 3[2mms[22m[39m[33m (retry x2)[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/PluginManager.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 36[2mms[22m[39m[35m 65 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAudioDevices.simplified.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 31[2mms[22m[39m[35m 58 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/useAmi.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 32[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/validators.test.ts [2m([22m[2m69 tests[22m[2m)[22m[32m 32[2mms[22m[39m[35m 60 MB heap used[39m
 [32mâœ“[39m tests/unit/stores/deviceStore.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 19[2mms[22m[39m[35m 58 MB heap used[39m
 [32mâœ“[39m tests/unit/validators.test.ts [2m([22m[2m58 tests[22m[2m)[22m[32m 14[2mms[22m[39m[35m 59 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/RecordingPlugin.persistence.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 28[2mms[22m[39m[35m 57 MB heap used[39m
 [32mâœ“[39m tests/unit/stores/index.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 8[2mms[22m[39m[35m 57 MB heap used[39m
 [32mâœ“[39m tests/unit/storage/LocalStorageAdapter.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 50[2mms[22m[39m[35m 56 MB heap used[39m
 [32mâœ“[39m tests/unit/logger.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 23[2mms[22m[39m[35m 60 MB heap used[39m
[90mstderr[2m | tests/unit/composables/useOAuth2.test.ts[2m > [22m[2museOAuth2[2m > [22m[2mComposable Creation[2m > [22m[2mshould create composable with default options
[22m[39m[Vue warn]: onMounted is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.

[90mstderr[2m | tests/unit/composables/useOAuth2.test.ts[2m > [22m[2museOAuth2[2m > [22m[2mComposable Creation[2m > [22m[2mshould expose all state refs
[22m[39m[Vue warn]: onMounted is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.

[90mstderr[2m | tests/unit/composables/useOAuth2.test.ts[2m > [22m[2museOAuth2[2m > [22m[2mComposable Creation[2m > [22m[2mshould expose all methods
[22m[39m[Vue warn]: onMounted is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.

[90mstderr[2m | tests/unit/composables/useOAuth2.test.ts[2m > [22m[2museOAuth2[2m > [22m[2mComposable Creation[2m > [22m[2mshould expose service instance
[22m[39m[Vue warn]: onMounted is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.

[90mstderr[2m | tests/unit/composables/useOAuth2.test.ts[2m > [22m[2museOAuth2[2m > [22m[2mComposable Creation[2m > [22m[2mshould expose isOnCallbackPage computed
[22m[39m[Vue warn]: onMounted is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.

[90mstderr[2m | tests/unit/composables/useOAuth2.test.ts[2m > [22m[2museOAuth2[2m > [22m[2mCustom Options[2m > [22m[2mshould respect autoInitialize option
[22m[39m[Vue warn]: onMounted is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.

[90mstderr[2m | tests/unit/composables/useOAuth2.test.ts[2m > [22m[2museOAuth2[2m > [22m[2mCustom Options[2m > [22m[2mshould respect autoHandleCallback option
[22m[39m[Vue warn]: onMounted is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.

[90mstderr[2m | tests/unit/composables/useOAuth2.test.ts[2m > [22m[2museOAuth2[2m > [22m[2mCustom Options[2m > [22m[2mshould respect custom callbackPath
[22m[39m[Vue warn]: onMounted is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.

 [32mâœ“[39m tests/unit/composables/useOAuth2.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 19[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/errorContext.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 21[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/RecordingPlugin.download.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 10[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/errorHelpers.test.ts [2m([22m[2m32 tests[22m[2m)[22m[32m 22[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/adapters/AdapterFactory.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 15[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/SipClient.media.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 21[2mms[22m[39m[35m 65 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/RecordingPlugin.security.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 6[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/AnalyticsPlugin.lifecycle.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 17[2mms[22m[39m[35m 63 MB heap used[39m
 [32mâœ“[39m tests/unit/SipClient.conference.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 9[2mms[22m[39m[35m 58 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/AnalyticsPlugin.security.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 6[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/providers/index.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 6[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/SipClient.messaging.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 15[2mms[22m[39m[35m 59 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/index.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 5[2mms[22m[39m[35m 67 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/RecordingPlugin.lifecycle.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 5[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/plugins/RecordingPlugin.concurrency.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 8[2mms[22m[39m[35m 62 MB heap used[39m
 [32mâœ“[39m tests/unit/utils/env.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 10[2mms[22m[39m[35m 60 MB heap used[39m
 [32mâœ“[39m tests/unit/adapters/index.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 5[2mms[22m[39m[35m 56 MB heap used[39m
 [32mâœ“[39m tests/unit/storage/index.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 4[2mms[22m[39m[35m 57 MB heap used[39m
 [32mâœ“[39m tests/unit/configuration.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 2[2mms[22m[39m[35m 55 MB heap used[39m
 [32mâœ“[39m tests/unit/composables/index.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 5[2mms[22m[39m[35m 72 MB heap used[39m
 [32mâœ“[39m tests/unit/index.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 7[2mms[22m[39m[35m 84 MB heap used[39m
 [32mâœ“[39m tests/integration/agent-to-agent.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 8209[2mms[22m[39m[35m 65 MB heap used[39m
       [33m[2mâœ“[22m[39m should establish a call between two agents [33m 420[2mms[22m[39m[35m 59 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow agent to answer incoming call [33m 355[2mms[22m[39m[35m 59 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow agent to reject incoming call [33m 356[2mms[22m[39m[35m 60 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow either party to terminate a call [33m 508[2mms[22m[39m[35m 61 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle multiple sequential calls [33m 754[2mms[22m[39m[35m 62 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle simultaneous calls to different agents [33m 563[2mms[22m[39m[35m 64 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow agent to hold and unhold a call [33m 512[2mms[22m[39m[35m 65 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow agent to transfer a call [33m 412[2mms[22m[39m[35m 66 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow agent to send DTMF tones [33m 426[2mms[22m[39m[35m 67 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow agents to enable/disable audio [33m 412[2mms[22m[39m[35m 64 MB heap used[39m
       [33m[2mâœ“[22m[39m should allow agents to enable/disable video [33m 410[2mms[22m[39m[35m 65 MB heap used[39m
       [33m[2mâœ“[22m[39m should emit events when presence status changes [33m 307[2mms[22m[39m[35m 68 MB heap used[39m
       [33m[2mâœ“[22m[39m should track agent metrics accurately [33m 563[2mms[22m[39m[35m 70 MB heap used[39m
       [33m[2mâœ“[22m[39m should cleanup agent resources properly [33m 409[2mms[22m[39m[35m 64 MB heap used[39m
 [32mâœ“[39m tests/integration/multi-agent-conference.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 8833[2mms[22m[39m[35m 73 MB heap used[39m
       [33m[2mâœ“[22m[39m should create a conference with 5 participants [33m 365[2mms[22m[39m[35m 60 MB heap used[39m
       [33m[2mâœ“[22m[39m should create a large conference with 10 participants [33m 614[2mms[22m[39m[35m 63 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle multiple concurrent conferences [33m 414[2mms[22m[39m[35m 65 MB heap used[39m
       [33m[2mâœ“[22m[39m should track conference duration [33m 369[2mms[22m[39m[35m 61 MB heap used[39m
       [33m[2mâœ“[22m[39m should retrieve conference information [33m 320[2mms[22m[39m[35m 63 MB heap used[39m
       [33m[2mâœ“[22m[39m should track all participants in conference [33m 367[2mms[22m[39m[35m 65 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle agent leaving conference [33m 310[2mms[22m[39m[35m 66 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle adding more participants after conference starts [33m 407[2mms[22m[39m[35m 68 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle simultaneous conferences with different participants [33m 509[2mms[22m[39m[35m 71 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle conference with 15 participants [33m 889[2mms[22m[39m[35m 68 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle conference with 20 participants [33m 1150[2mms[22m[39m[35m 74 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle ending large conference cleanly [33m 732[2mms[22m[39m[35m 71 MB heap used[39m
 [32mâœ“[39m tests/unit/core/DTMFManager.test.ts [2m([22m[2m40 tests[22m[2m)[22m[33m 11578[2mms[22m[39m[35m 62 MB heap used[39m
       [33m[2mâœ“[22m[39m should successfully send multiple tones [33m 625[2mms[22m[39m[35m 57 MB heap used[39m
       [33m[2mâœ“[22m[39m should validate and clamp duration within allowed range [33m 6044[2mms[22m[39m[35m 58 MB heap used[39m
       [33m[2mâœ“[22m[39m should validate and clamp interToneGap within allowed range [33m 373[2mms[22m[39m[35m 58 MB heap used[39m
       [33m[2mâœ“[22m[39m should emit tone events for each tone [33m 625[2mms[22m[39m[35m 59 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle concurrent send requests by queuing [33m 393[2mms[22m[39m[35m 61 MB heap used[39m
 [32mâœ“[39m tests/integration/agent-complex-scenarios.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 11762[2mms[22m[39m[35m 70 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle blind call transfer [33m 465[2mms[22m[39m[35m 58 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle attended call transfer [33m 463[2mms[22m[39m[35m 59 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle call transfer chain (A->B->C->D) [33m 462[2mms[22m[39m[35m 61 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle agent making multiple simultaneous calls [33m 308[2mms[22m[39m[35m 62 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle agent receiving multiple simultaneous calls [33m 413[2mms[22m[39m[35m 63 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle answering multiple calls sequentially [33m 407[2mms[22m[39m[35m 64 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle rejecting one call while accepting another [33m 411[2mms[22m[39m[35m 59 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle call hold and resume [33m 562[2mms[22m[39m[35m 60 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle multiple holds and resumes [33m 767[2mms[22m[39m[35m 61 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle holding one call while talking on another [33m 568[2mms[22m[39m[35m 63 MB heap used[39m
       [33m[2mâœ“[22m[39m should send DTMF sequence for PIN entry [33m 461[2mms[22m[39m[35m 64 MB heap used[39m
       [33m[2mâœ“[22m[39m should send DTMF for menu navigation [33m 760[2mms[22m[39m[35m 66 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle rapid DTMF input [33m 461[2mms[22m[39m[35m 67 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle complete call workflow with all features [33m 565[2mms[22m[39m[35m 62 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle call escalation (voice to video) [33m 471[2mms[22m[39m[35m 63 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle call de-escalation (video to voice) [33m 461[2mms[22m[39m[35m 65 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle call failure and retry [33m 416[2mms[22m[39m[35m 66 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle network interruption during call [33m 626[2mms[22m[39m[35m 68 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle agent reconnection after disconnect [33m 479[2mms[22m[39m[35m 70 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle rapid sequential calls [33m 842[2mms[22m[39m[35m 73 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle many messages in quick succession [33m 305[2mms[22m[39m[35m 64 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle agent managing many simultaneous operations [33m 319[2mms[22m[39m[35m 66 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle status changes during calls [33m 460[2mms[22m[39m[35m 68 MB heap used[39m
       [33m[2mâœ“[22m[39m should handle message exchange based on presence [33m 306[2mms[22m[39m[35m 70 MB heap used[39m
 [31mâ¯[39m tests/unit/SipClient.presence-comprehensive.test.ts [2m([22m[2m36 tests[22m[2m | [22m[31m32 failed[39m[2m)[22m[33m 450810[2mms[22m[39m[35m 46 MB heap used[39m
[31m       [31mÃ—[31m should publish basic available presence[39m[33m 30058[2mms[22m[39m[33m (retry x2)[39m[35m 58 MB heap used[39m
[31m       [31mÃ—[31m should publish busy presence[39m[33m 30027[2mms[22m[39m[33m (retry x2)[39m[35m 41 MB heap used[39m
[31m       [31mÃ—[31m should publish DND (Do Not Disturb) presence[39m[33m 30032[2mms[22m[39m[33m (retry x2)[39m[35m 41 MB heap used[39m
[31m       [31mÃ—[31m should publish away presence[39m[33m 30030[2mms[22m[39m[33m (retry x2)[39m[35m 41 MB heap used[39m
[31m       [31mÃ—[31m should publish offline presence[39m[33m 30030[2mms[22m[39m[33m (retry x2)[39m[35m 42 MB heap used[39m
[31m       [31mÃ—[31m should publish presence with custom note[39m[33m 30298[2mms[22m[39m[33m (retry x2)[39m[35m 42 MB heap used[39m
[31m       [31mÃ—[31m should publish presence with activity[39m[33m 30031[2mms[22m[39m[33m (retry x2)[39m[35m 42 MB heap used[39m
[31m       [31mÃ—[31m should publish presence with custom expiry[39m[33m 30032[2mms[22m[39m[33m (retry x2)[39m[35m 42 MB heap used[39m
[31m       [31mÃ—[31m should track published presence state[39m[33m 30028[2mms[22m[39m[33m (retry x2)[39m[35m 42 MB heap used[39m
[31m       [31mÃ—[31m should handle publish with extra headers[39m[32m 6[2mms[22m[39m[33m (retry x2)[39m[35m 43 MB heap used[39m
[31m       [31mÃ—[31m should generate valid PIDF+XML for open status[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 43 MB heap used[39m
[31m       [31mÃ—[31m should generate valid PIDF+XML for busy status[39m[32m 0[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should include entity attribute with SIP URI[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should include timestamp in presence document[39m[33m 30021[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should properly escape XML special characters in note[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should subscribe to presence of another user[39m[33m 30022[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should subscribe with custom expires[39m[32m 2[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should subscribe with extra headers[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should track active subscriptions[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should handle duplicate subscription requests[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should unsubscribe from presence[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 44 MB heap used[39m
[31m       [31mÃ—[31m should send SUBSCRIBE with expires=0 for unsubscribe[39m[32m 0[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should remove subscription from tracking[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should handle unsubscribe of non-existent subscription[39m[32m 0[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should receive presence notification[39m[33m 30041[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should parse PIDF+XML presence status[39m[33m 30029[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should extract presence note from PIDF+XML[39m[33m 30039[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
       [32mâœ“[39m should handle publish failure[32m 2[2mms[22m[39m[35m 45 MB heap used[39m
       [32mâœ“[39m should handle subscribe failure[32m 0[2mms[22m[39m[35m 45 MB heap used[39m
       [32mâœ“[39m should handle malformed PIDF+XML in notification[32m 0[2mms[22m[39m[35m 45 MB heap used[39m
       [32mâœ“[39m should handle missing status in PIDF+XML[32m 0[2mms[22m[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should support presence refresh before expiry[39m[33m 30065[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should support subscription refresh[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 46 MB heap used[39m
[31m       [31mÃ—[31m should handle multiple concurrent publishes[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 45 MB heap used[39m
[31m       [31mÃ—[31m should handle multiple concurrent subscriptions[39m[32m 0[2mms[22m[39m[33m (retry x2)[39m[35m 46 MB heap used[39m
[31m       [31mÃ—[31m should manage multiple active subscriptions[39m[32m 1[2mms[22m[39m[33m (retry x2)[39m[35m 46 MB heap used[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 97 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould create peer connection
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould create peer connection
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould create peer connection
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m309:14[22m[39m
    [90m307| [39m    [34mit[39m([32m'should create peer connection'[39m[33m,[39m () [33m=>[39m {
    [90m308| [39m      [35mconst[39m _pc [33m=[39m mediaManager[33m.[39m[34mcreatePeerConnection[39m()
    [90m309| [39m      [34mexpect[39m(pc)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m             [31m^[39m
    [90m310| [39m      [34mexpect[39m(pc)[33m.[39m[34mtoBeInstanceOf[39m([33mMockRTCPeerConnection[39m)
    [90m311| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould close peer connection
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould close peer connection
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould close peer connection
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m330:33[22m[39m
    [90m328| [39m    [34mit[39m([32m'should close peer connection'[39m[33m,[39m () [33m=>[39m {
    [90m329| [39m      [35mconst[39m _pc [33m=[39m mediaManager[33m.[39m[34mcreatePeerConnection[39m()
    [90m330| [39m      [35mconst[39m closeSpy [33m=[39m vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'close'[39m)
    [90m   | [39m                                [31m^[39m
    [90m331| [39m
    [90m332| [39m      mediaManager[33m.[39m[34mclosePeerConnection[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould setup peer connection event handlers
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould setup peer connection event handlers
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould setup peer connection event handlers
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m338:14[22m[39m
    [90m336| [39m    [34mit[39m([32m'should setup peer connection event handlers'[39m[33m,[39m () [33m=>[39m {
    [90m337| [39m      const _pc = mediaManager.createPeerConnection() as MockRTCPeerCoâ€¦
    [90m338| [39m      [34mexpect[39m(pc[33m.[39monicecandidate)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m             [31m^[39m
    [90m339| [39m      [34mexpect[39m(pc[33m.[39moniceconnectionstatechange)[33m.[39m[34mtoBeDefined[39m()
    [90m340| [39m      [34mexpect[39m(pc[33m.[39monicegatheringstatechange)[33m.[39m[34mtoBeDefined[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE candidate event
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE candidate event
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE candidate event
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m357:7[22m[39m
    [90m355| [39m
    [90m356| [39m      [35mconst[39m eventPromise [33m=[39m eventBus[33m.[39m[34mwaitFor[39m([32m'media:ice:candidate'[39m)
    [90m357| [39m      pc[33m.[39m[34monicecandidate[39m[33m?.[39m({ candidate[33m:[39m mockCandidate } [35mas[39m any)
    [90m   | [39m      [31m^[39m
    [90m358| [39m
    [90m359| [39m      [35mconst[39m event [33m=[39m [35mawait[39m eventPromise

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE gathering complete event on null candidate
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE gathering complete event on null candidate
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE gathering complete event on null candidate
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m367:7[22m[39m
    [90m365| [39m
    [90m366| [39m      const eventPromise = eventBus.waitFor('media:ice:gathering:complâ€¦
    [90m367| [39m      pc[33m.[39m[34monicecandidate[39m[33m?.[39m({ candidate[33m:[39m [35mnull[39m } [35mas[39m any)
    [90m   | [39m      [31m^[39m
    [90m368| [39m
    [90m369| [39m      [35mawait[39m eventPromise

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE connection state change event
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE connection state change event
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit ICE connection state change event
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m377:7[22m[39m
    [90m375| [39m      const eventPromise = eventBus.waitFor('media:ice:connection:statâ€¦
    [90m376| [39m
    [90m377| [39m      pc[33m.[39miceConnectionState [33m=[39m [32m'connected'[39m
    [90m   | [39m      [31m^[39m
    [90m378| [39m      pc[33m.[39m[34moniceconnectionstatechange[39m[33m?.[39m()
    [90m379| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould handle connection failure
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould handle connection failure
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould handle connection failure
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m389:7[22m[39m
    [90m387| [39m      [35mconst[39m eventPromise [33m=[39m eventBus[33m.[39m[34mwaitFor[39m([32m'media:connection:failed'[39m)
    [90m388| [39m
    [90m389| [39m      pc[33m.[39miceConnectionState [33m=[39m [32m'failed'[39m
    [90m   | [39m      [31m^[39m
    [90m390| [39m      pc[33m.[39m[34moniceconnectionstatechange[39m[33m?.[39m()
    [90m391| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit track added event
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit track added event
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mRTCPeerConnection Lifecycle[2m > [22mshould emit track added event
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m403:7[22m[39m
    [90m401| [39m
    [90m402| [39m      [35mconst[39m eventPromise [33m=[39m eventBus[33m.[39m[34mwaitFor[39m([32m'media:track:added'[39m)
    [90m403| [39m      pc[33m.[39m[34montrack[39m[33m?.[39m({ track[33m:[39m mockTrack[33m,[39m streams[33m:[39m [mockStream] } [35mas[39m any)
    [90m   | [39m      [31m^[39m
    [90m404| [39m
    [90m405| [39m      [35mconst[39m payload [33m=[39m [35mawait[39m eventPromise

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mSDP Negotiation[2m > [22mshould set local description
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mSDP Negotiation[2m > [22mshould set local description
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mSDP Negotiation[2m > [22mshould set local description
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m434:14[22m[39m
    [90m432| [39m
    [90m433| [39m      [35mconst[39m _pc [33m=[39m mediaManager[33m.[39m[34mgetPeerConnection[39m()
    [90m434| [39m      [34mexpect[39m(pc[33m.[39mlocalDescription)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m             [31m^[39m
    [90m435| [39m      [34mexpect[39m(pc[33m.[39mlocalDescription[33m?.[39mtype)[33m.[39m[34mtoBe[39m([32m'offer'[39m)
    [90m436| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mSDP Negotiation[2m > [22mshould set remote description
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mSDP Negotiation[2m > [22mshould set remote description
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mSDP Negotiation[2m > [22mshould set remote description
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m443:14[22m[39m
    [90m441| [39m
    [90m442| [39m      [35mconst[39m _pc [33m=[39m mediaManager[33m.[39m[34mgetPeerConnection[39m()
    [90m443| [39m      [34mexpect[39m(pc[33m.[39mremoteDescription)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m             [31m^[39m
    [90m444| [39m      [34mexpect[39m(pc[33m.[39mremoteDescription[33m?.[39mtype)[33m.[39m[34mtoBe[39m([32m'answer'[39m)
    [90m445| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mMedia Stream Management[2m > [22mshould remove local stream from peer connection
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mMedia Stream Management[2m > [22mshould remove local stream from peer connection
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mMedia Stream Management[2m > [22mshould remove local stream from peer connection
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m627:14[22m[39m
    [90m625| [39m
    [90m626| [39m      [35mconst[39m _pc [33m=[39m mediaManager[33m.[39m[34mgetPeerConnection[39m()
    [90m627| [39m      [34mexpect[39m(pc[33m.[39m[34mgetSenders[39m())[33m.[39m[34mtoHaveLength[39m([34m0[39m)
    [90m   | [39m             [31m^[39m
    [90m628| [39m    })
    [90m629| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include ICE candidate type statistics
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include ICE candidate type statistics
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include ICE candidate type statistics
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1059:16[22m[39m
    [90m1057| [39m
    [90m1058| [39m      [90m// Mock getStats to include local and remote candidate types[39m
    [90m1059| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1060| [39m        [35mnew[39m [33mMap[39m([
    [90m1061| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include transport statistics
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include transport statistics
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include transport statistics
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1098:16[22m[39m
    [90m1096| [39m
    [90m1097| [39m      [90m// Mock getStats to include transport stats[39m
    [90m1098| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1099| [39m        [35mnew[39m [33mMap[39m([
    [90m1100| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include outbound video statistics
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include outbound video statistics
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mStatistics Collection[2m > [22mshould include outbound video statistics
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1131:16[22m[39m
    [90m1129| [39m
    [90m1130| [39m      [90m// Mock getStats to include outbound-rtp video stats[39m
    [90m1131| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1132| [39m        [35mnew[39m [33mMap[39m([
    [90m1133| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mCleanup[2m > [22mshould close peer connection on destroy
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mCleanup[2m > [22mshould close peer connection on destroy
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mCleanup[2m > [22mshould close peer connection on destroy
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1187:33[22m[39m
    [90m1185| [39m    [34mit[39m([32m'should close peer connection on destroy'[39m[33m,[39m () [33m=>[39m {
    [90m1186| [39m      [35mconst[39m _pc [33m=[39m mediaManager[33m.[39m[34mcreatePeerConnection[39m()
    [90m1187| [39m      [35mconst[39m closeSpy [33m=[39m vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'close'[39m)
    [90m   | [39m                                [31m^[39m
    [90m1188| [39m
    [90m1189| [39m      mediaManager[33m.[39m[34mdestroy[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high audio packet loss
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high audio packet loss
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high audio packet loss
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1505:16[22m[39m
    [90m1503| [39m
    [90m1504| [39m      [90m// Mock high packet loss stats[39m
    [90m1505| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1506| [39m        [35mnew[39m [33mMap[39m([
    [90m1507| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high video packet loss
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high video packet loss
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high video packet loss
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1539:16[22m[39m
    [90m1537| [39m
    [90m1538| [39m      [90m// Mock high video packet loss[39m
    [90m1539| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1540| [39m        [35mnew[39m [33mMap[39m([
    [90m1541| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high round trip time
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high round trip time
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould warn on high round trip time
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1569:16[22m[39m
    [90m1567| [39m
    [90m1568| [39m      [90m// Mock high RTT[39m
    [90m1569| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1570| [39m        [35mnew[39m [33mMap[39m([
    [90m1571| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould stop quality adjustment on destroy
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould stop quality adjustment on destroy
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould stop quality adjustment on destroy
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1618:43[22m[39m
    [90m1616| [39m
    [90m1617| [39m      [90m// Trigger connection success to start quality adjustment[39m
    [90m1618| [39m      const oniceconnectionstatechange = (pc as any).oniceconnectionstâ€¦
    [90m   | [39m                                          [31m^[39m
    [90m1619| [39m      [35mif[39m (oniceconnectionstatechange) {
    [90m1620| [39m        [33m;[39m(pc [35mas[39m any)[33m.[39miceConnectionState [33m=[39m [32m'connected'[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould handle adjustQuality errors in interval callback
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould handle adjustQuality errors in interval callback
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould handle adjustQuality errors in interval callback
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1638:16[22m[39m
    [90m1636| [39m
    [90m1637| [39m      [90m// Mock getStats to throw error[39m
    [90m1638| [39m      vi.spyOn(pc, 'getStats').mockRejectedValue(new Error('Stats collâ€¦
    [90m   | [39m               [31m^[39m
    [90m1639| [39m
    [90m1640| [39m      // Trigger connection success to start quality adjustment intervâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[20/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould execute adjustQuality when interval fires
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould execute adjustQuality when interval fires
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould execute adjustQuality when interval fires
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1663:16[22m[39m
    [90m1661| [39m
    [90m1662| [39m      [90m// Mock stats with high packet loss to trigger warning[39m
    [90m1663| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1664| [39m        [35mnew[39m [33mMap[39m([
    [90m1665| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[21/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould skip adjustQuality when peer connection is null
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould skip adjustQuality when peer connection is null
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould skip adjustQuality when peer connection is null
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1707:36[22m[39m
    [90m1705| [39m
    [90m1706| [39m      [35mconst[39m _pc [33m=[39m mediaManager[33m.[39m[34mcreatePeerConnection[39m()
    [90m1707| [39m      [35mconst[39m getStatsSpy [33m=[39m vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)
    [90m   | [39m                                   [31m^[39m
    [90m1708| [39m
    [90m1709| [39m      [90m// Trigger connection success to start quality adjustment[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould not start quality adjustment interval twice
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould not start quality adjustment interval twice
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould not start quality adjustment interval twice
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1736:16[22m[39m
    [90m1734| [39m
    [90m1735| [39m      [90m// Mock getStats to succeed[39m
    [90m1736| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1737| [39m        [35mnew[39m [33mMap[39m([
    [90m1738| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[23/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould detect high video packet loss in adjustQuality
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould detect high video packet loss in adjustQuality
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mQuality Adjustment[2m > [22mshould detect high video packet loss in adjustQuality
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m1777:16[22m[39m
    [90m1775| [39m
    [90m1776| [39m      // Mock stats with high VIDEO packet loss to trigger warning on â€¦
    [90m1777| [39m      vi[33m.[39m[34mspyOn[39m(pc[33m,[39m [32m'getStats'[39m)[33m.[39m[34mmockResolvedValue[39m(
    [90m   | [39m               [31m^[39m
    [90m1778| [39m        [35mnew[39m [33mMap[39m([
    [90m1779| [39m          [

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[24/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould include TURN servers with credentialType
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould include TURN servers with credentialType
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould include TURN servers with credentialType
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m2185:14[22m[39m
    [90m2183| [39m      [35mconst[39m _pc [33m=[39m manager[33m.[39m[34mcreatePeerConnection[39m()
    [90m2184| [39m
    [90m2185| [39m      [34mexpect[39m(pc)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m             [31m^[39m
    [90m2186| [39m      [34mexpect[39m((pc [35mas[39m any)[33m.[39mconfig[33m.[39miceServers)[33m.[39m[34mtoBeDefined[39m()
    [90m2187| [39m      [34mexpect[39m((pc [35mas[39m any)[33m.[39mconfig[33m.[39miceServers[33m.[39mlength)[33m.[39m[34mtoBeGreaterThan[39m([34m1[39m)

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[25/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould handle TURN servers without credentialType
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould handle TURN servers without credentialType
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould handle TURN servers without credentialType
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m2218:14[22m[39m
    [90m2216| [39m      [35mconst[39m _pc [33m=[39m manager[33m.[39m[34mcreatePeerConnection[39m()
    [90m2217| [39m
    [90m2218| [39m      [34mexpect[39m(pc)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m             [31m^[39m
    [90m2219| [39m
    [90m2220| [39m      const turnServer = (pc as any).config.iceServers.find((server: aâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[26/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould handle multiple TURN servers
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould handle multiple TURN servers
[41m[1m FAIL [22m[49m tests/unit/MediaManager.test.ts[2m > [22mMediaManager[2m > [22mICE Configuration Edge Cases[2m > [22mshould handle multiple TURN servers
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m tests/unit/MediaManager.test.ts:[2m2255:14[22m[39m
    [90m2253| [39m      [35mconst[39m _pc [33m=[39m manager[33m.[39m[34mcreatePeerConnection[39m()
    [90m2254| [39m
    [90m2255| [39m      [34mexpect[39m(pc)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m             [31m^[39m
    [90m2256| [39m
    [90m2257| [39m      const turnServers = (pc as any).config.iceServers.filter((serverâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[27/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould make call with custom SDP
[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould make call with custom SDP
[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould make call with custom SDP
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'sip:2000@example.com', â€¦(1) ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    "sip:2000@example.com",[22m
[32m-   ObjectContaining {[90m
[32m-     "sessionDescriptionHandlerOptions": Any<Object>,[90m
[31m+   {[90m
[31m+     "anonymous": undefined,[90m
[31m+     "extraHeaders": [],[90m
[31m+     "mediaConstraints": {[90m
[31m+       "audio": true,[90m
[31m+       "video": false,[90m
[31m+     },[90m
[31m+     "rtcConfiguration": undefined,[90m
[31m+     "sessionTimersExpires": 90,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m tests/unit/SipClient.calls.test.ts:[2m253:27[22m[39m
    [90m251| [39m      await sipClient.call(target, { sessionDescriptionHandlerOptions:â€¦
    [90m252| [39m
    [90m253| [39m      [34mexpect[39m(mockUA[33m.[39mcall)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                          [31m^[39m
    [90m254| [39m        target[33m,[39m
    [90m255| [39m        expect[33m.[39m[34mobjectContaining[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[28/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould handle call with RTCPeerConnection configuration
[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould handle call with RTCPeerConnection configuration
[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould handle call with RTCPeerConnection configuration
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'sip:2000@example.com', â€¦(1) ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    "sip:2000@example.com",[22m
[32m-   ObjectContaining {[90m
[32m-     "pcConfig": {[90m
[32m-       "iceServers": [[90m
[2m    {[22m
[32m-           "urls": "stun:stun.l.google.com:19302",[90m
[32m-         },[90m
[32m-       ],[90m
[31m+     "anonymous": undefined,[90m
[31m+     "extraHeaders": [],[90m
[31m+     "mediaConstraints": {[90m
[31m+       "audio": true,[90m
[31m+       "video": false,[90m
[2m      },[22m
[31m+     "rtcConfiguration": undefined,[90m
[31m+     "sessionTimersExpires": 90,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m tests/unit/SipClient.calls.test.ts:[2m269:27[22m[39m
    [90m267| [39m      [35mawait[39m sipClient[33m.[39m[34mcall[39m(target[33m,[39m { pcConfig })
    [90m268| [39m
    [90m269| [39m      [34mexpect[39m(mockUA[33m.[39mcall)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                          [31m^[39m
    [90m270| [39m        target[33m,[39m
    [90m271| [39m        expect[33m.[39m[34mobjectContaining[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[29/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould use makeCall for backward compatibility
[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould use makeCall for backward compatibility
[41m[1m FAIL [22m[49m tests/unit/SipClient.calls.test.ts[2m > [22mSipClient - Call Management[2m > [22mOutgoing Calls[2m > [22mshould use makeCall for backward compatibility
[31m[1mAssertionError[22m: expected 'undefined' to be 'string' // Object.is equality[39m

Expected: [32m"string"[39m
Received: [31m"undefined"[39m

[36m [2mâ¯[22m tests/unit/SipClient.calls.test.ts:[2m289:29[22m[39m
    [90m287| [39m      [35mconst[39m _callId [33m=[39m [35mawait[39m sipClient[33m.[39m[34mmakeCall[39m(target)
    [90m288| [39m
    [90m289| [39m      [34mexpect[39m([35mtypeof[39m callId)[33m.[39m[34mtoBe[39m([32m'string'[39m)
    [90m   | [39m                            [31m^[39m
    [90m290| [39m      [34mexpect[39m(callId[33m.[39mlength)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)
    [90m291| [39m      [34mexpect[39m(mockUA[33m.[39mcall)[33m.[39m[34mtoHaveBeenCalled[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[30/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.e2e-mode.test.ts[2m > [22mSipClient - E2E Test Mode[2m > [22mE2E Mode State Management[2m > [22mshould maintain consistent state in E2E mode
[41m[1m FAIL [22m[49m tests/unit/SipClient.e2e-mode.test.ts[2m > [22mSipClient - E2E Test Mode[2m > [22mE2E Mode State Management[2m > [22mshould maintain consistent state in E2E mode
[41m[1m FAIL [22m[49m tests/unit/SipClient.e2e-mode.test.ts[2m > [22mSipClient - E2E Test Mode[2m > [22mE2E Mode State Management[2m > [22mshould maintain consistent state in E2E mode
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/SipClient.e2e-mode.test.ts:[2m390:37[22m[39m
    [90m388| [39m      [35mconst[39m state [33m=[39m sipClient[33m.[39m[34mgetState[39m()
    [90m389| [39m      [34mexpect[39m(state[33m.[39mconnectionState)[33m.[39m[34mtoBe[39m([33mConnectionState[39m[33m.[39m[33mConnected[39m)
    [90m390| [39m      [34mexpect[39m(sipClient[33m.[39misConnected)[33m.[39m[34mtoBe[39m([35mtrue[39m)
    [90m   | [39m                                    [31m^[39m
    [90m391| [39m
    [90m392| [39m      [35mawait[39m sipClient[33m.[39m[34mstop[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[31/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.e2e-mode.test.ts[2m > [22mSipClient - E2E Test Mode[2m > [22mE2E Mode State Management[2m > [22mshould allow stop in E2E mode
[41m[1m FAIL [22m[49m tests/unit/SipClient.e2e-mode.test.ts[2m > [22mSipClient - E2E Test Mode[2m > [22mE2E Mode State Management[2m > [22mshould allow stop in E2E mode
[41m[1m FAIL [22m[49m tests/unit/SipClient.e2e-mode.test.ts[2m > [22mSipClient - E2E Test Mode[2m > [22mE2E Mode State Management[2m > [22mshould allow stop in E2E mode
[31m[1mAssertionError[22m: expected 'connected' to be 'disconnected' // Object.is equality[39m

Expected: [32m"[7mdis[27mconnected"[39m
Received: [31m"connected"[39m

[36m [2mâ¯[22m tests/unit/SipClient.e2e-mode.test.ts:[2m402:37[22m[39m
    [90m400| [39m
    [90m401| [39m      [35mconst[39m state [33m=[39m sipClient[33m.[39m[34mgetState[39m()
    [90m402| [39m      [34mexpect[39m(state[33m.[39mconnectionState)[33m.[39m[34mtoBe[39m([33mConnectionState[39m[33m.[39m[33mDisconnected[39m)
    [90m   | [39m                                    [31m^[39m
    [90m403| [39m    })
    [90m404| [39m  })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[32/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle event with missing data gracefully
[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle event with missing data gracefully
[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle event with missing data gracefully
[31m[1mTypeError[22m: Cannot read properties of null (reading 'originator')[39m
[36m [2mâ¯[22m src/core/SipClient.ts:[2m758:22[22m[39m
    [90m756| [39m
    [90m757| [39m      [90m// Extract message details[39m
    [90m758| [39m      const from = e.originator === 'remote' ? e.request?.from?.uri?.tâ€¦
    [90m   | [39m                     [31m^[39m
    [90m759| [39m      [35mconst[39m contentType [33m=[39m e[33m.[39mrequest[33m?.[39m[34mgetHeader[39m([32m'Content-Type'[39m)
    [90m760| [39m      [35mconst[39m content [33m=[39m e[33m.[39mrequest[33m?.[39mbody [33m||[39m [32m''[39m
[90m [2mâ¯[22m tests/unit/SipClient.error-recovery.test.ts:[2m22:7[22m[39m
[90m [2mâ¯[22m triggerEvent2 tests/unit/SipClient.error-recovery.test.ts:[2m21:14[22m[39m
[90m [2mâ¯[22m tests/unit/SipClient.error-recovery.test.ts:[2m329:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[33/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle malformed event data
[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle malformed event data
[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle malformed event data
[31m[1mTypeError[22m: e.request?.getHeader is not a function[39m
[36m [2mâ¯[22m src/core/SipClient.ts:[2m759:38[22m[39m
    [90m757| [39m      [90m// Extract message details[39m
    [90m758| [39m      const from = e.originator === 'remote' ? e.request?.from?.uri?.tâ€¦
    [90m759| [39m      [35mconst[39m contentType [33m=[39m e[33m.[39mrequest[33m?.[39m[34mgetHeader[39m([32m'Content-Type'[39m)
    [90m   | [39m                                     [31m^[39m
    [90m760| [39m      [35mconst[39m content [33m=[39m e[33m.[39mrequest[33m?.[39mbody [33m||[39m [32m''[39m
    [90m761| [39m
[90m [2mâ¯[22m tests/unit/SipClient.error-recovery.test.ts:[2m22:7[22m[39m
[90m [2mâ¯[22m triggerEvent2 tests/unit/SipClient.error-recovery.test.ts:[2m21:14[22m[39m
[90m [2mâ¯[22m tests/unit/SipClient.error-recovery.test.ts:[2m341:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[34/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle event during shutdown
[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle event during shutdown
[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mEvent Handler Edge Cases[2m > [22mshould handle event during shutdown
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2mâ¯[22m src/core/SipClient.ts:[2m724:33[22m[39m
    [90m722| [39m
    [90m723| [39m      [35mconst[39m rtcSession [33m=[39m e[33m.[39msession
    [90m724| [39m      [35mconst[39m callId [33m=[39m rtcSession[33m.[39mid [33m||[39m [35mthis[39m[33m.[39m[34mgenerateCallId[39m()
    [90m   | [39m                                [31m^[39m
    [90m725| [39m
    [90m726| [39m      [90m// Track incoming calls[39m
[90m [2mâ¯[22m tests/unit/SipClient.error-recovery.test.ts:[2m22:7[22m[39m
[90m [2mâ¯[22m triggerEvent2 tests/unit/SipClient.error-recovery.test.ts:[2m21:14[22m[39m
[90m [2mâ¯[22m tests/unit/SipClient.error-recovery.test.ts:[2m360:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[35/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mState Consistency[2m > [22mshould track isRegistered property accurately
[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mState Consistency[2m > [22mshould track isRegistered property accurately
[41m[1m FAIL [22m[49m tests/unit/SipClient.error-recovery.test.ts[2m > [22mSipClient - Error Recovery & Edge Cases[2m > [22mState Consistency[2m > [22mshould track isRegistered property accurately
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/unit/SipClient.error-recovery.test.ts:[2m422:38[22m[39m
    [90m420| [39m      [35mawait[39m registerPromise
    [90m421| [39m
    [90m422| [39m      [34mexpect[39m(sipClient[33m.[39misRegistered)[33m.[39m[34mtoBe[39m([35mtrue[39m)
    [90m   | [39m                                     [31m^[39m
    [90m423| [39m
    [90m424| [39m      [35mconst[39m unregisterPromise [33m=[39m sipClient[33m.[39m[34munregister[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[36/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish basic available presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish basic available presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish basic available presence
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m149:5[22m[39m
    [90m147| [39m
    [90m148| [39m  [34mdescribe[39m([32m'Presence Publishing'[39m[33m,[39m () [33m=>[39m {
    [90m149| [39m    [34mit[39m([32m'should publish basic available presence'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m150| [39m      [35mawait[39m [34mstartClient[39m()
    [90m151| [39m      [35mconst[39m publishEvents[33m:[39m any[] [33m=[39m []

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[37/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish busy presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish busy presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish busy presence
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m164:5[22m[39m
    [90m162| [39m    })
    [90m163| [39m
    [90m164| [39m    [34mit[39m([32m'should publish busy presence'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m165| [39m      [35mawait[39m [34mstartClient[39m()
    [90m166| [39m      [35mawait[39m sipClient[33m.[39m[34mpublishPresence[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[38/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish DND (Do Not Disturb) presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish DND (Do Not Disturb) presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish DND (Do Not Disturb) presence
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m180:5[22m[39m
    [90m178| [39m    })
    [90m179| [39m
    [90m180| [39m    [34mit[39m([32m'should publish DND (Do Not Disturb) presence'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m181| [39m      [35mawait[39m [34mstartClient[39m()
    [90m182| [39m      [35mawait[39m sipClient[33m.[39m[34mpublishPresence[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[39/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish away presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish away presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish away presence
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m190:5[22m[39m
    [90m188| [39m    })
    [90m189| [39m
    [90m190| [39m    [34mit[39m([32m'should publish away presence'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m191| [39m      [35mawait[39m [34mstartClient[39m()
    [90m192| [39m      [35mawait[39m sipClient[33m.[39m[34mpublishPresence[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[40/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish offline presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish offline presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish offline presence
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m200:5[22m[39m
    [90m198| [39m    })
    [90m199| [39m
    [90m200| [39m    [34mit[39m([32m'should publish offline presence'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m201| [39m      [35mawait[39m [34mstartClient[39m()
    [90m202| [39m      [35mawait[39m sipClient[33m.[39m[34mpublishPresence[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[41/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with custom note
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with custom note
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with custom note
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m210:5[22m[39m
    [90m208| [39m    })
    [90m209| [39m
    [90m210| [39m    [34mit[39m([32m'should publish presence with custom note'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m211| [39m      [35mawait[39m [34mstartClient[39m()
    [90m212| [39m      [35mconst[39m customNote [33m=[39m [32m'Custom status message with details'[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[42/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with activity
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with activity
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with activity
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m223:5[22m[39m
    [90m221| [39m    })
    [90m222| [39m
    [90m223| [39m    [34mit[39m([32m'should publish presence with activity'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m224| [39m      [35mawait[39m [34mstartClient[39m()
    [90m225| [39m      [35mawait[39m sipClient[33m.[39m[34mpublishPresence[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[43/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with custom expiry
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with custom expiry
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould publish presence with custom expiry
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m235:5[22m[39m
    [90m233| [39m    })
    [90m234| [39m
    [90m235| [39m    [34mit[39m([32m'should publish presence with custom expiry'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m236| [39m      [35mawait[39m [34mstartClient[39m()
    [90m237| [39m      [35mawait[39m sipClient[33m.[39m[34mpublishPresence[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[44/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould track published presence state
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould track published presence state
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould track published presence state
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m246:5[22m[39m
    [90m244| [39m    })
    [90m245| [39m
    [90m246| [39m    [34mit[39m([32m'should track published presence state'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m247| [39m      [35mawait[39m [34mstartClient[39m()
    [90m248| [39m      [35mawait[39m sipClient[33m.[39m[34mpublishPresence[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[45/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould handle publish with extra headers
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould handle publish with extra headers
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Publishing[2m > [22mshould handle publish with extra headers
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.publishPresence src/core/SipClient.ts:[2m1779:13[22m[39m
    [90m1777| [39m  async publishPresence(presence: PresencePublishOptions): Promise<voiâ€¦
    [90m1778| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1779| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1780| [39m    }
    [90m1781| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m258:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[46/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould generate valid PIDF+XML for open status
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould generate valid PIDF+XML for open status
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould generate valid PIDF+XML for open status
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.publishPresence src/core/SipClient.ts:[2m1779:13[22m[39m
    [90m1777| [39m  async publishPresence(presence: PresencePublishOptions): Promise<voiâ€¦
    [90m1778| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1779| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1780| [39m    }
    [90m1781| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m276:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[47/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould generate valid PIDF+XML for busy status
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould generate valid PIDF+XML for busy status
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould generate valid PIDF+XML for busy status
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.publishPresence src/core/SipClient.ts:[2m1779:13[22m[39m
    [90m1777| [39m  async publishPresence(presence: PresencePublishOptions): Promise<voiâ€¦
    [90m1778| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1779| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1780| [39m    }
    [90m1781| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m290:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[48/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould include entity attribute with SIP URI
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould include entity attribute with SIP URI
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould include entity attribute with SIP URI
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.publishPresence src/core/SipClient.ts:[2m1779:13[22m[39m
    [90m1777| [39m  async publishPresence(presence: PresencePublishOptions): Promise<voiâ€¦
    [90m1778| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1779| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1780| [39m    }
    [90m1781| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m301:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[49/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould include timestamp in presence document
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould include timestamp in presence document
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould include timestamp in presence document
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m310:5[22m[39m
    [90m308| [39m    })
    [90m309| [39m
    [90m310| [39m    [34mit[39m([32m'should include timestamp in presence document'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m311| [39m      [35mawait[39m [34mstartClient[39m()
    [90m312| [39m      [35mawait[39m sipClient[33m.[39m[34mpublishPresence[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[50/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould properly escape XML special characters in note
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould properly escape XML special characters in note
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence PIDF+XML Document Generation[2m > [22mshould properly escape XML special characters in note
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.publishPresence src/core/SipClient.ts:[2m1779:13[22m[39m
    [90m1777| [39m  async publishPresence(presence: PresencePublishOptions): Promise<voiâ€¦
    [90m1778| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1779| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1780| [39m    }
    [90m1781| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m322:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[51/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe to presence of another user
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe to presence of another user
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe to presence of another user
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m335:5[22m[39m
    [90m333| [39m
    [90m334| [39m  [34mdescribe[39m([32m'Presence Subscription'[39m[33m,[39m () [33m=>[39m {
    [90m335| [39m    [34mit[39m([32m'should subscribe to presence of another user'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m336| [39m      [35mawait[39m [34mstartClient[39m()
    [90m337| [39m      [35mconst[39m subscribeEvents[33m:[39m any[] [33m=[39m []

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[52/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe with custom expires
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe with custom expires
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe with custom expires
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.subscribePresence src/core/SipClient.ts:[2m1873:13[22m[39m
    [90m1871| [39m  async subscribePresence(uri: string, options?: PresenceSubscriptionOâ€¦
    [90m1872| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1873| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1874| [39m    }
    [90m1875| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m348:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[53/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe with extra headers
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe with extra headers
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould subscribe with extra headers
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.subscribePresence src/core/SipClient.ts:[2m1873:13[22m[39m
    [90m1871| [39m  async subscribePresence(uri: string, options?: PresenceSubscriptionOâ€¦
    [90m1872| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1873| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1874| [39m    }
    [90m1875| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m356:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[54/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould track active subscriptions
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould track active subscriptions
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould track active subscriptions
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.subscribePresence src/core/SipClient.ts:[2m1873:13[22m[39m
    [90m1871| [39m  async subscribePresence(uri: string, options?: PresenceSubscriptionOâ€¦
    [90m1872| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1873| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1874| [39m    }
    [90m1875| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m370:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[55/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould handle duplicate subscription requests
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould handle duplicate subscription requests
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Subscription[2m > [22mshould handle duplicate subscription requests
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.subscribePresence src/core/SipClient.ts:[2m1873:13[22m[39m
    [90m1871| [39m  async subscribePresence(uri: string, options?: PresenceSubscriptionOâ€¦
    [90m1872| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1873| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1874| [39m    }
    [90m1875| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m378:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[56/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould unsubscribe from presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould unsubscribe from presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould unsubscribe from presence
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould send SUBSCRIBE with expires=0 for unsubscribe
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould send SUBSCRIBE with expires=0 for unsubscribe
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould send SUBSCRIBE with expires=0 for unsubscribe
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould remove subscription from tracking
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould remove subscription from tracking
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould remove subscription from tracking
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould handle unsubscribe of non-existent subscription
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould handle unsubscribe of non-existent subscription
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Unsubscription[2m > [22mshould handle unsubscribe of non-existent subscription
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.subscribePresence src/core/SipClient.ts:[2m1873:13[22m[39m
    [90m1871| [39m  async subscribePresence(uri: string, options?: PresenceSubscriptionOâ€¦
    [90m1872| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1873| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1874| [39m    }
    [90m1875| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m388:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[57/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould receive presence notification
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould receive presence notification
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould receive presence notification
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m426:5[22m[39m
    [90m424| [39m
    [90m425| [39m  [34mdescribe[39m([32m'Presence Notification Receiving'[39m[33m,[39m () [33m=>[39m {
    [90m426| [39m    [34mit[39m([32m'should receive presence notification'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m427| [39m      [35mawait[39m [34mstartClient[39m()
    [90m428| [39m      [35mconst[39m notifyEvents[33m:[39m any[] [33m=[39m []

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[58/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould parse PIDF+XML presence status
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould parse PIDF+XML presence status
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould parse PIDF+XML presence status
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m458:5[22m[39m
    [90m456| [39m    })
    [90m457| [39m
    [90m458| [39m    [34mit[39m([32m'should parse PIDF+XML presence status'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m459| [39m      [35mawait[39m [34mstartClient[39m()
    [90m460| [39m      [35mconst[39m mockRequest [33m=[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[59/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould extract presence note from PIDF+XML
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould extract presence note from PIDF+XML
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Notification Receiving[2m > [22mshould extract presence note from PIDF+XML
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m486:5[22m[39m
    [90m484| [39m    })
    [90m485| [39m
    [90m486| [39m    [34mit[39m([32m'should extract presence note from PIDF+XML'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m487| [39m      [35mawait[39m [34mstartClient[39m()
    [90m488| [39m      [35mconst[39m mockRequest [33m=[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[60/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Refresh[2m > [22mshould support presence refresh before expiry
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Refresh[2m > [22mshould support presence refresh before expiry
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Refresh[2m > [22mshould support presence refresh before expiry
[31m[1mError[22m: Test timed out in 10000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m590:5[22m[39m
    [90m588| [39m
    [90m589| [39m  [34mdescribe[39m([32m'Presence Refresh'[39m[33m,[39m () [33m=>[39m {
    [90m590| [39m    [34mit[39m([32m'should support presence refresh before expiry'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m591| [39m      [35mawait[39m [34mstartClient[39m()
    [90m592| [39m      [90m// First publish[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[61/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Refresh[2m > [22mshould support subscription refresh
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Refresh[2m > [22mshould support subscription refresh
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mPresence Refresh[2m > [22mshould support subscription refresh
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.subscribePresence src/core/SipClient.ts:[2m1873:13[22m[39m
    [90m1871| [39m  async subscribePresence(uri: string, options?: PresenceSubscriptionOâ€¦
    [90m1872| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1873| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1874| [39m    }
    [90m1875| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m611:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[62/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould handle multiple concurrent publishes
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould handle multiple concurrent publishes
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould handle multiple concurrent publishes
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.publishPresence src/core/SipClient.ts:[2m1779:13[22m[39m
    [90m1777| [39m  async publishPresence(presence: PresencePublishOptions): Promise<voiâ€¦
    [90m1778| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1779| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1780| [39m    }
    [90m1781| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m623:19[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[63/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould handle multiple concurrent subscriptions
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould handle multiple concurrent subscriptions
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould handle multiple concurrent subscriptions
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.subscribePresence src/core/SipClient.ts:[2m1873:13[22m[39m
    [90m1871| [39m  async subscribePresence(uri: string, options?: PresenceSubscriptionOâ€¦
    [90m1872| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1873| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1874| [39m    }
    [90m1875| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m635:19[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[64/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould manage multiple active subscriptions
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould manage multiple active subscriptions
[41m[1m FAIL [22m[49m tests/unit/SipClient.presence-comprehensive.test.ts[2m > [22mSipClient - Comprehensive Presence[2m > [22mMultiple Presence Operations[2m > [22mshould manage multiple active subscriptions
[31m[1mError[22m: SIP client is not started[39m
[36m [2mâ¯[22m SipClient.subscribePresence src/core/SipClient.ts:[2m1873:13[22m[39m
    [90m1871| [39m  async subscribePresence(uri: string, options?: PresenceSubscriptionOâ€¦
    [90m1872| [39m    [35mif[39m ([33m![39m[35mthis[39m[33m.[39mua) {
    [90m1873| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'SIP client is not started'[39m)
    [90m   | [39m            [31m^[39m
    [90m1874| [39m    }
    [90m1875| [39m
[90m [2mâ¯[22m tests/unit/SipClient.presence-comprehensive.test.ts:[2m646:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[65/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.registration.test.ts[2m > [22mSipClient - Registration Management[2m > [22mRegistration Flow[2m > [22mshould register successfully
[41m[1m FAIL [22m[49m tests/unit/SipClient.registration.test.ts[2m > [22mSipClient - Registration Management[2m > [22mRegistration Flow[2m > [22mshould register successfully
[41m[1m FAIL [22m[49m tests/unit/SipClient.registration.test.ts[2m > [22mSipClient - Registration Management[2m > [22mRegistration Flow[2m > [22mshould register successfully
[31m[1mAssertionError[22m: expected 600 to be 3600 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3600[39m
[31m+ 600[39m

[36m [2mâ¯[22m tests/unit/SipClient.registration.test.ts:[2m151:40[22m[39m
    [90m149| [39m      expect(state.registrationState).toBe(RegistrationState.Registereâ€¦
    [90m150| [39m      [34mexpect[39m(state[33m.[39mregisteredUri)[33m.[39m[34mtoContain[39m([32m'1000@example.com'[39m)
    [90m151| [39m      [34mexpect[39m(state[33m.[39mregistrationExpiry)[33m.[39m[34mtoBe[39m([34m3600[39m)
    [90m   | [39m                                       [31m^[39m
    [90m152| [39m      [34mexpect[39m(state[33m.[39mlastRegistrationTime)[33m.[39m[34mtoBeInstanceOf[39m([33mDate[39m)
    [90m153| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[66/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/SipClient.registration.test.ts[2m > [22mSipClient - Registration Management[2m > [22mUnregistration Flow[2m > [22mshould unregister successfully
[41m[1m FAIL [22m[49m tests/unit/SipClient.registration.test.ts[2m > [22mSipClient - Registration Management[2m > [22mUnregistration Flow[2m > [22mshould unregister successfully
[41m[1m FAIL [22m[49m tests/unit/SipClient.registration.test.ts[2m > [22mSipClient - Registration Management[2m > [22mUnregistration Flow[2m > [22mshould unregister successfully
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'cause')[39m
[36m [2mâ¯[22m src/core/SipClient.ts:[2m696:18[22m[39m
    [90m694| [39m        type[33m:[39m [32m'sip:unregistered'[39m[33m,[39m
    [90m695| [39m        timestamp[33m:[39m [35mnew[39m [33mDate[39m()[33m,[39m
    [90m696| [39m        cause[33m:[39m e[33m.[39mcause[33m,[39m
    [90m   | [39m                 [31m^[39m
    [90m697| [39m      } satisfies [33mSipUnregisteredEvent[39m)
    [90m698| [39m    })
[90m [2mâ¯[22m tests/unit/SipClient.registration.test.ts:[2m20:35[22m[39m
[90m [2mâ¯[22m triggerEvent2 tests/unit/SipClient.registration.test.ts:[2m20:14[22m[39m
[90m [2mâ¯[22m tests/unit/SipClient.registration.test.ts:[2m211:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[67/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould parse 24-hour time "14:30"
[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould parse 24-hour time "14:30"
[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould parse 24-hour time "14:30"
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2mâ¯[22m tests/unit/core/FreePBXPresenceBridge.test.ts:[2m211:33[22m[39m
    [90m209| [39m      [35mconst[39m result [33m=[39m bridge[33m.[39m[34mparsePIDF[39m(pidf[33m,[39m [32m'1001'[39m)
    [90m210| [39m
    [90m211| [39m      [34mexpect[39m(result[33m.[39mreturnTime)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m                                [31m^[39m
    [90m212| [39m    })
    [90m213| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[68/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould parse relative duration "1 hour"
[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould parse relative duration "1 hour"
[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould parse relative duration "1 hour"
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2mâ¯[22m tests/unit/core/FreePBXPresenceBridge.test.ts:[2m230:33[22m[39m
    [90m228| [39m      [35mconst[39m result [33m=[39m bridge[33m.[39m[34mparsePIDF[39m(pidf[33m,[39m [32m'1001'[39m)
    [90m229| [39m
    [90m230| [39m      [34mexpect[39m(result[33m.[39mreturnTime)[33m.[39m[34mtoBeDefined[39m()
    [90m   | [39m                                [31m^[39m
    [90m231| [39m      [34mexpect[39m(result[33m.[39mreturnTime[33m?.[39mdurationMinutes)[33m.[39m[34mtoBe[39m([34m60[39m)
    [90m232| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[69/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould detect overdue return times
[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould detect overdue return times
[41m[1m FAIL [22m[49m tests/unit/core/FreePBXPresenceBridge.test.ts[2m > [22mFreePBXPresenceBridge[2m > [22mReturn Time Parsing[2m > [22mshould detect overdue return times
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m tests/unit/core/FreePBXPresenceBridge.test.ts:[2m281:44[22m[39m
    [90m279| [39m      [35mconst[39m result [33m=[39m bridge[33m.[39m[34mparsePIDF[39m(pidf[33m,[39m [32m'1001'[39m)
    [90m280| [39m
    [90m281| [39m      [34mexpect[39m(result[33m.[39mreturnTime[33m?.[39misOverdue)[33m.[39m[34mtoBe[39m([35mtrue[39m)
    [90m   | [39m                                           [31m^[39m
    [90m282| [39m      [34mexpect[39m(result[33m.[39mreturnTime[33m?.[39mremainingMs)[33m.[39m[34mtoBe[39m([34m0[39m)
    [90m283| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[70/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/core/MultiLineManager.test.ts[2m > [22mMultiLineManager[2m > [22mConference Management[2m > [22mshould get all active conferences
[31m[1mAssertionError[22m: expected [ { id: 'conf-1766793684463', â€¦(5) } ] to have a length of 2 but got 1[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 1[39m

[36m [2mâ¯[22m tests/unit/core/MultiLineManager.test.ts:[2m959:27[22m[39m
    [90m957| [39m      [35mconst[39m conferences [33m=[39m manager[33m.[39m[34mgetActiveConferences[39m()
    [90m958| [39m
    [90m959| [39m      [34mexpect[39m(conferences)[33m.[39m[34mtoHaveLength[39m([34m2[39m)
    [90m   | [39m                          [31m^[39m
    [90m960| [39m    })
    [90m961| [39m  })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[71/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/core/MultiLineManager.test.ts[2m > [22mMultiLineManager[2m > [22mConference Management[2m > [22mshould get all active conferences
[31m[1mAssertionError[22m: expected [ { id: 'conf-1766793684474', â€¦(5) } ] to have a length of 2 but got 1[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 1[39m

[36m [2mâ¯[22m tests/unit/core/MultiLineManager.test.ts:[2m959:27[22m[39m
    [90m957| [39m      [35mconst[39m conferences [33m=[39m manager[33m.[39m[34mgetActiveConferences[39m()
    [90m958| [39m
    [90m959| [39m      [34mexpect[39m(conferences)[33m.[39m[34mtoHaveLength[39m([34m2[39m)
    [90m   | [39m                          [31m^[39m
    [90m960| [39m    })
    [90m961| [39m  })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[72/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/core/MultiLineManager.test.ts[2m > [22mMultiLineManager[2m > [22mConference Management[2m > [22mshould get all active conferences
[31m[1mAssertionError[22m: expected [ { id: 'conf-1766793684476', â€¦(5) } ] to have a length of 2 but got 1[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 1[39m

[36m [2mâ¯[22m tests/unit/core/MultiLineManager.test.ts:[2m959:27[22m[39m
    [90m957| [39m      [35mconst[39m conferences [33m=[39m manager[33m.[39m[34mgetActiveConferences[39m()
    [90m958| [39m
    [90m959| [39m      [34mexpect[39m(conferences)[33m.[39m[34mtoHaveLength[39m([34m2[39m)
    [90m   | [39m                          [31m^[39m
    [90m960| [39m    })
    [90m961| [39m  })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[73/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Initialization[2m > [22mshould render without crashing
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Initialization[2m > [22mshould render without crashing
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Initialization[2m > [22mshould render without crashing
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m112:14[22m[39m
    [90m110| [39m      [35mawait[39m [34mnextTick[39m()
    [90m111| [39m
    [90m112| [39m      [34mexpect[39m(wrapper[33m.[39m[34mexists[39m())[33m.[39m[34mtoBe[39m([35mtrue[39m)
    [90m   | [39m             [31m^[39m
    [90m113| [39m      [34mexpect[39m(wrapper[33m.[39m[34mtext[39m())[33m.[39m[34mtoBe[39m([32m'Child'[39m)
    [90m114| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[74/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould provide device lists to children
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould provide device lists to children
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould provide device lists to children
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m206:24[22m[39m
    [90m204| [39m      [35mawait[39m [34mnextTick[39m()
    [90m205| [39m
    [90m206| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m207| [39m      [34mexpect[39m(consumer[33m.[39mvm[33m.[39mmedia)[33m.[39m[34mtoBeDefined[39m()
    [90m208| [39m      expect(consumer.vm.media.audioInputDevices.length).toBeGreaterThâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[75/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould auto-select default devices when autoSelectDefaults is true
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould auto-select default devices when autoSelectDefaults is true
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould auto-select default devices when autoSelectDefaults is true
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m227:24[22m[39m
    [90m225| [39m      [35mawait[39m [34mnextTick[39m()
    [90m226| [39m
    [90m227| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m228| [39m      expect(consumer.vm.media.selectedAudioInputId).toBe('audio-inputâ€¦
    [90m229| [39m      expect(consumer.vm.media.selectedAudioOutputId).toBe('audio-outpâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[76/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould not auto-select devices when autoSelectDefaults is false
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould not auto-select devices when autoSelectDefaults is false
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Management[2m > [22mshould not auto-select devices when autoSelectDefaults is false
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m248:24[22m[39m
    [90m246| [39m      [35mawait[39m [34mnextTick[39m()
    [90m247| [39m
    [90m248| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m249| [39m      [34mexpect[39m(consumer[33m.[39mvm[33m.[39mmedia[33m.[39mselectedAudioInputId)[33m.[39m[34mtoBeNull[39m()
    [90m250| [39m      [34mexpect[39m(consumer[33m.[39mvm[33m.[39mmedia[33m.[39mselectedAudioOutputId)[33m.[39m[34mtoBeNull[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[77/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow enumerating devices via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow enumerating devices via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow enumerating devices via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m270:24[22m[39m
    [90m268| [39m      [35mawait[39m [34mnextTick[39m()
    [90m269| [39m
    [90m270| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m271| [39m      [35mconst[39m devices [33m=[39m [35mawait[39m consumer[33m.[39mvm[33m.[39mmedia[33m.[39m[34menumerateDevices[39m()
    [90m272| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[78/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting audio input via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting audio input via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting audio input via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m292:24[22m[39m
    [90m290| [39m      [35mawait[39m [34mnextTick[39m()
    [90m291| [39m
    [90m292| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m293| [39m      consumer[33m.[39mvm[33m.[39mmedia[33m.[39m[34mselectAudioInput[39m([32m'audio-input-1'[39m)
    [90m294| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[79/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting audio output via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting audio output via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting audio output via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m315:24[22m[39m
    [90m313| [39m      [35mawait[39m [34mnextTick[39m()
    [90m314| [39m
    [90m315| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m316| [39m      consumer[33m.[39mvm[33m.[39mmedia[33m.[39m[34mselectAudioOutput[39m([32m'audio-output-1'[39m)
    [90m317| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[80/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting video input via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting video input via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow selecting video input via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m338:24[22m[39m
    [90m336| [39m      [35mawait[39m [34mnextTick[39m()
    [90m337| [39m
    [90m338| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m339| [39m      consumer[33m.[39mvm[33m.[39mmedia[33m.[39m[34mselectVideoInput[39m([32m'video-input-1'[39m)
    [90m340| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[81/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow requesting audio permission via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow requesting audio permission via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow requesting audio permission via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m361:24[22m[39m
    [90m359| [39m      [35mawait[39m [34mnextTick[39m()
    [90m360| [39m
    [90m361| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m362| [39m      [35mconst[39m granted [33m=[39m [35mawait[39m consumer[33m.[39mvm[33m.[39mmedia[33m.[39m[34mrequestAudioPermission[39m()
    [90m363| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[82/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow requesting video permission via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow requesting video permission via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow requesting video permission via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m399:24[22m[39m
    [90m397| [39m      })
    [90m398| [39m
    [90m399| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m400| [39m      [35mconst[39m granted [33m=[39m [35mawait[39m consumer[33m.[39mvm[33m.[39mmedia[33m.[39m[34mrequestVideoPermission[39m()
    [90m401| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[83/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow getting device by ID via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow getting device by ID via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mProvider Context Methods[2m > [22mshould allow getting device by ID via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m418:24[22m[39m
    [90m416| [39m      [35mawait[39m [34mnextTick[39m()
    [90m417| [39m
    [90m418| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m419| [39m      [35mconst[39m device [33m=[39m consumer[33m.[39mvm[33m.[39mmedia[33m.[39m[34mgetDeviceById[39m([32m'audio-input-1'[39m)
    [90m420| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[84/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Change Monitoring[2m > [22mshould remove device change listener on unmount
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Change Monitoring[2m > [22mshould remove device change listener on unmount
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Change Monitoring[2m > [22mshould remove device change listener on unmount
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m511:7[22m[39m
    [90m509| [39m      const removeEventListenerSpy = vi.spyOn(navigator.mediaDevices, â€¦
    [90m510| [39m
    [90m511| [39m      wrapper[33m.[39m[34munmount[39m()
    [90m   | [39m      [31m^[39m
    [90m512| [39m
    [90m513| [39m      [35mawait[39m [34mnextTick[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[85/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22museMediaProvider Hook[2m > [22mshould return media context when used within provider
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22museMediaProvider Hook[2m > [22mshould return media context when used within provider
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22museMediaProvider Hook[2m > [22mshould return media context when used within provider
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m610:24[22m[39m
    [90m608| [39m      [35mawait[39m [34mnextTick[39m()
    [90m609| [39m
    [90m610| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m611| [39m      [34mexpect[39m(consumer[33m.[39mvm[33m.[39mmedia)[33m.[39m[34mtoBeDefined[39m()
    [90m612| [39m      expect(typeof consumer.vm.media.enumerateDevices).toBe('functionâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[86/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould expose reactive device lists
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould expose reactive device lists
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould expose reactive device lists
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m647:24[22m[39m
    [90m645| [39m      [35mawait[39m [34mnextTick[39m()
    [90m646| [39m
    [90m647| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m648| [39m
    [90m649| [39m      [34mexpect[39m(consumer[33m.[39mvm[33m.[39mmedia[33m.[39maudioInputDevices)[33m.[39m[34mtoBeDefined[39m()

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[87/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould expose reactive permission status
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould expose reactive permission status
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould expose reactive permission status
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m670:24[22m[39m
    [90m668| [39m      [35mawait[39m [34mnextTick[39m()
    [90m669| [39m
    [90m670| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m671| [39m
    [90m672| [39m      expect(consumer.vm.media.audioPermission).toBe(PermissionStatus.â€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[88/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould update reactive state when devices change
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould update reactive state when devices change
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mReactive State[2m > [22mshould update reactive state when devices change
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m689:24[22m[39m
    [90m687| [39m      [35mawait[39m [34mnextTick[39m()
    [90m688| [39m
    [90m689| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m690| [39m
    [90m691| [39m      [90m// Initial device count[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[89/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould expose testAudioInput method via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould expose testAudioInput method via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould expose testAudioInput method via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m727:24[22m[39m
    [90m725| [39m      [35mawait[39m [34mnextTick[39m()
    [90m726| [39m
    [90m727| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m728| [39m      [34mexpect[39m([35mtypeof[39m consumer[33m.[39mvm[33m.[39mmedia[33m.[39mtestAudioInput)[33m.[39m[34mtoBe[39m([32m'function'[39m)
    [90m729| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[90/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould expose testAudioOutput method via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould expose testAudioOutput method via context
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould expose testAudioOutput method via context
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m743:24[22m[39m
    [90m741| [39m      [35mawait[39m [34mnextTick[39m()
    [90m742| [39m
    [90m743| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m744| [39m      [34mexpect[39m([35mtypeof[39m consumer[33m.[39mvm[33m.[39mmedia[33m.[39mtestAudioOutput)[33m.[39m[34mtoBe[39m([32m'function'[39m)
    [90m745| [39m    })

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[91/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio input device
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio input device
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio input device
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m759:24[22m[39m
    [90m757| [39m      [35mawait[39m [34mnextTick[39m()
    [90m758| [39m
    [90m759| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m760| [39m
    [90m761| [39m      [90m// Test with specific device ID[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[92/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio input device with options
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio input device with options
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio input device with options
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m778:24[22m[39m
    [90m776| [39m      [35mawait[39m [34mnextTick[39m()
    [90m777| [39m
    [90m778| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m779| [39m
    [90m780| [39m      [90m// Test with options[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[93/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing default audio input when no deviceId provided
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing default audio input when no deviceId provided
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing default audio input when no deviceId provided
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m798:24[22m[39m
    [90m796| [39m      [35mawait[39m [34mnextTick[39m()
    [90m797| [39m
    [90m798| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m799| [39m
    [90m800| [39m      [90m// Test without device ID (uses selected or default)[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[94/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio output device
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio output device
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing audio output device
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m817:24[22m[39m
    [90m815| [39m      [35mawait[39m [34mnextTick[39m()
    [90m816| [39m
    [90m817| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m818| [39m
    [90m819| [39m      [90m// Test with specific device ID[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[95/291]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing default audio output when no deviceId provided
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing default audio output when no deviceId provided
[41m[1m FAIL [22m[49m tests/unit/providers/MediaProvider.test.ts[2m > [22mMediaProvider[2m > [22mDevice Testing Methods[2m > [22mshould allow testing default audio output when no deviceId provided
[31m[1mReferenceError[22m: wrapper is not defined[39m
[36m [2mâ¯[22m tests/unit/providers/MediaProvider.test.ts:[2m836:24[22m[39m
    [90m834| [39m      [35mawait[39m [34mnextTick[39m()
    [90m835| [39m
    [90m836| [39m      [35mconst[39m consumer [33m=[39m wrapper[33m.[39m[34mfindComponent[39m([33mConsumerComponent[39m)
    [90m   | [39m                       [31m^[39m
    [90m837| [39m
    [90m838| [39m      [90m// Test without device ID (uses selected or default)[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[96/291]â¯[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Unhandled Errors [49m[22m[31mâ¯â¯â¯â¯â¯â¯[39m
[31m[1m
Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.[22m[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mReferenceError[22m: pc is not defined[39m
[36m [2mâ¯[22m Timeout._onTimeout tests/unit/MediaManager.test.ts:[2m465:9[22m[39m
    [90m463| [39m      [90m// Simulate gathering complete[39m
    [90m464| [39m      [34msetTimeout[39m(() [33m=>[39m {
    [90m465| [39m        pc[33m.[39miceGatheringState [33m=[39m [32m'complete'[39m
    [90m   | [39m        [31m^[39m
    [90m466| [39m        pc[33m.[39m[34monicegatheringstatechange[39m[33m?.[39m()
    [90m467| [39m        pc[33m.[39m[34monicecandidate[39m[33m?.[39m({ candidate[33m:[39m [35mnull[39m } [35mas[39m any)
[90m [2mâ¯[22m listOnTimeout node:internal/timers:[2m588:17[22m[39m
[90m [2mâ¯[22m processTimers node:internal/timers:[2m523:7[22m[39m

[31mThis error originated in "[1mtests/unit/MediaManager.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould wait for ICE gathering[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m
[31mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[39m


[2m Test Files [22m [1m[31m9 failed[39m[22m[2m | [22m[1m[32m123 passed[39m[22m[90m (132)[39m
[2m      Tests [22m [1m[31m97 failed[39m[22m[2m | [22m[1m[32m4207 passed[39m[22m[2m | [22m[33m7 skipped[39m[90m (4311)[39m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 01:01:19
[2m   Duration [22m 459.00s[2m (transform 24.19s, setup 25.95s, collect 32.14s, tests 530.00s, environment 118.12s, prepare 2.92s)[22m

